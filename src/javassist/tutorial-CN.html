<!doctype html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width initial-scale=1'>
    <title>tutorial</title>
    <link href='vue/fonts.css' rel='stylesheet' type='text/css'/>
    <style type='text/css'>html {
        overflow-x: initial !important;
    }

    :root {
        --bg-color: #ffffff;
        --text-color: #333333;
        --select-text-bg-color: #B5D6FC;
        --select-text-font-color: auto;
        --monospace: "Lucida Console", Consolas, "Courier", monospace;
    }

    html {
        font-size: 14px;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
    }

    body {
        margin: 0px;
        padding: 0px;
        height: auto;
        bottom: 0px;
        top: 0px;
        left: 0px;
        right: 0px;
        font-size: 1rem;
        line-height: 1.42857;
        overflow-x: hidden;
        background: inherit;
        tab-size: 4;
    }

    iframe {
        margin: auto;
    }

    a.url {
        word-break: break-all;
    }

    a:active, a:hover {
        outline: 0px;
    }

    .in-text-selection, ::selection {
        text-shadow: none;
        background: var(--select-text-bg-color);
        color: var(--select-text-font-color);
    }

    #write {
        margin: 0px auto;
        height: auto;
        width: inherit;
        word-break: normal;
        word-wrap: break-word;
        position: relative;
        white-space: normal;
        overflow-x: visible;
        padding-top: 40px;
    }

    #write.first-line-indent p {
        text-indent: 2em;
    }

    #write.first-line-indent li p, #write.first-line-indent p * {
        text-indent: 0px;
    }

    #write.first-line-indent li {
        margin-left: 2em;
    }

    .for-image #write {
        padding-left: 8px;
        padding-right: 8px;
    }

    body.typora-export {
        padding-left: 30px;
        padding-right: 30px;
    }

    .typora-export .footnote-line, .typora-export li, .typora-export p {
        white-space: pre-wrap;
    }

    @media screen and (max-width: 500px) {
        body.typora-export {
            padding-left: 0px;
            padding-right: 0px;
        }

        #write {
            padding-left: 20px;
            padding-right: 20px;
        }

        .CodeMirror-sizer {
            margin-left: 0px !important;
        }

        .CodeMirror-gutters {
            display: none !important;
        }
    }

    #write li > figure:first-child {
        margin-top: -20px;
    }

    #write ol, #write ul {
        position: relative;
    }

    img {
        max-width: 100%;
        vertical-align: middle;
    }

    button, input, select, textarea {
        color: inherit;
        font-style: inherit;
        font-variant: inherit;
        font-weight: inherit;
        font-stretch: inherit;
        font-size: inherit;
        line-height: inherit;
        font-family: inherit;
    }

    input[type="checkbox"], input[type="radio"] {
        line-height: normal;
        padding: 0px;
    }

    *, ::after, ::before {
        box-sizing: border-box;
    }

    #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre {
        width: inherit;
    }

    #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p {
        position: relative;
    }

    h1, h2, h3, h4, h5, h6 {
        break-after: avoid-page;
        break-inside: avoid;
        orphans: 2;
    }

    p {
        orphans: 4;
    }

    h1 {
        font-size: 2rem;
    }

    h2 {
        font-size: 1.8rem;
    }

    h3 {
        font-size: 1.6rem;
    }

    h4 {
        font-size: 1.4rem;
    }

    h5 {
        font-size: 1.2rem;
    }

    h6 {
        font-size: 1rem;
    }

    .md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p {
        margin-top: 1rem;
        margin-bottom: 1rem;
    }

    .hidden {
        display: none;
    }

    .md-blockmeta {
        color: rgb(204, 204, 204);
        font-weight: 700;
        font-style: italic;
    }

    a {
        cursor: pointer;
    }

    sup.md-footnote {
        padding: 2px 4px;
        background-color: rgba(238, 238, 238, 0.7);
        color: rgb(85, 85, 85);
        border-radius: 4px;
        cursor: pointer;
    }

    sup.md-footnote a, sup.md-footnote a:hover {
        color: inherit;
        text-transform: inherit;
        text-decoration: inherit;
    }

    #write input[type="checkbox"] {
        cursor: pointer;
        width: inherit;
        height: inherit;
    }

    figure {
        overflow-x: auto;
        margin: 1.2em 0px;
        max-width: calc(100% + 16px);
        padding: 0px;
    }

    figure > table {
        margin: 0px !important;
    }

    tr {
        break-inside: avoid;
        break-after: auto;
    }

    thead {
        display: table-header-group;
    }

    table {
        border-collapse: collapse;
        border-spacing: 0px;
        width: 100%;
        overflow: auto;
        break-inside: auto;
        text-align: left;
    }

    table.md-table td {
        min-width: 32px;
    }

    .CodeMirror-gutters {
        border-right: 0px;
        background-color: inherit;
    }

    .CodeMirror-linenumber {
        user-select: none;
    }

    .CodeMirror {
        text-align: left;
    }

    .CodeMirror-placeholder {
        opacity: 0.3;
    }

    .CodeMirror pre {
        padding: 0px 4px;
    }

    .CodeMirror-lines {
        padding: 0px;
    }

    div.hr:focus {
        cursor: none;
    }

    #write pre {
        white-space: pre-wrap;
    }

    #write.fences-no-line-wrapping pre {
        white-space: pre;
    }

    #write pre.ty-contain-cm {
        white-space: normal;
    }

    .CodeMirror-gutters {
        margin-right: 4px;
    }

    .md-fences {
        font-size: 0.9rem;
        display: block;
        break-inside: avoid;
        text-align: left;
        overflow: visible;
        white-space: pre;
        background: inherit;
        position: relative !important;
    }

    .md-diagram-panel {
        width: 100%;
        margin-top: 10px;
        text-align: center;
        padding-top: 0px;
        padding-bottom: 8px;
        overflow-x: auto;
    }

    #write .md-fences.mock-cm {
        white-space: pre-wrap;
    }

    .md-fences.md-fences-with-lineno {
        padding-left: 0px;
    }

    #write.fences-no-line-wrapping .md-fences.mock-cm {
        white-space: pre;
        overflow-x: auto;
    }

    .md-fences.mock-cm.md-fences-with-lineno {
        padding-left: 8px;
    }

    .CodeMirror-line, twitterwidget {
        break-inside: avoid;
    }

    .footnotes {
        opacity: 0.8;
        font-size: 0.9rem;
        margin-top: 1em;
        margin-bottom: 1em;
    }

    .footnotes + .footnotes {
        margin-top: 0px;
    }

    .md-reset {
        margin: 0px;
        padding: 0px;
        border: 0px;
        outline: 0px;
        vertical-align: top;
        background: 0px 0px;
        text-decoration: none;
        text-shadow: none;
        float: none;
        position: static;
        width: auto;
        height: auto;
        white-space: nowrap;
        cursor: inherit;
        -webkit-tap-highlight-color: transparent;
        line-height: normal;
        font-weight: 400;
        text-align: left;
        box-sizing: content-box;
        direction: ltr;
    }

    li div {
        padding-top: 0px;
    }

    blockquote {
        margin: 1rem 0px;
    }

    li .mathjax-block, li p {
        margin: 0.5rem 0px;
    }

    li {
        margin: 0px;
        position: relative;
    }

    blockquote > :last-child {
        margin-bottom: 0px;
    }

    blockquote > :first-child, li > :first-child {
        margin-top: 0px;
    }

    .footnotes-area {
        color: rgb(136, 136, 136);
        margin-top: 0.714rem;
        padding-bottom: 0.143rem;
        white-space: normal;
    }

    #write .footnote-line {
        white-space: pre-wrap;
    }

    @media print {
        body, html {
            border: 1px solid transparent;
            height: 99%;
            break-after: avoid;
            break-before: avoid;
        }

        #write {
            margin-top: 0px;
            padding-top: 0px;
            border-color: transparent !important;
        }

        .typora-export * {
            -webkit-print-color-adjust: exact;
        }

        html.blink-to-pdf {
            font-size: 13px;
        }

        .typora-export #write {
            padding-left: 32px;
            padding-right: 32px;
            padding-bottom: 0px;
            break-after: avoid;
        }

        .typora-export #write::after {
            height: 0px;
        }

        @page {
            margin: 20mm 0px;
        }
    }

    .footnote-line {
        margin-top: 0.714em;
        font-size: 0.7em;
    }

    a img, img a {
        cursor: pointer;
    }

    pre.md-meta-block {
        font-size: 0.8rem;
        min-height: 0.8rem;
        white-space: pre-wrap;
        background: rgb(204, 204, 204);
        display: block;
        overflow-x: hidden;
    }

    p > .md-image:only-child:not(.md-img-error) img, p > img:only-child {
        display: block;
        margin: auto;
    }

    p > .md-image:only-child {
        display: inline-block;
        width: 100%;
    }

    #write .MathJax_Display {
        margin: 0.8em 0px 0px;
    }

    .md-math-block {
        width: 100%;
    }

    .md-math-block:not(:empty)::after {
        display: none;
    }

    [contenteditable="true"]:active, [contenteditable="true"]:focus {
        outline: 0px;
        box-shadow: none;
    }

    .md-task-list-item {
        position: relative;
        list-style-type: none;
    }

    .task-list-item.md-task-list-item {
        padding-left: 0px;
    }

    .md-task-list-item > input {
        position: absolute;
        top: 0px;
        left: 0px;
        margin-left: -1.2em;
        margin-top: calc(1em - 10px);
        border: none;
    }

    .math {
        font-size: 1rem;
    }

    .md-toc {
        min-height: 3.58rem;
        position: relative;
        font-size: 0.9rem;
        border-radius: 10px;
    }

    .md-toc-content {
        position: relative;
        margin-left: 0px;
    }

    .md-toc-content::after, .md-toc::after {
        display: none;
    }

    .md-toc-item {
        display: block;
        color: rgb(65, 131, 196);
    }

    .md-toc-item a {
        text-decoration: none;
    }

    .md-toc-inner:hover {
        text-decoration: underline;
    }

    .md-toc-inner {
        display: inline-block;
        cursor: pointer;
    }

    .md-toc-h1 .md-toc-inner {
        margin-left: 0px;
        font-weight: 700;
    }

    .md-toc-h2 .md-toc-inner {
        margin-left: 2em;
    }

    .md-toc-h3 .md-toc-inner {
        margin-left: 4em;
    }

    .md-toc-h4 .md-toc-inner {
        margin-left: 6em;
    }

    .md-toc-h5 .md-toc-inner {
        margin-left: 8em;
    }

    .md-toc-h6 .md-toc-inner {
        margin-left: 10em;
    }

    @media screen and (max-width: 48em) {
        .md-toc-h3 .md-toc-inner {
            margin-left: 3.5em;
        }

        .md-toc-h4 .md-toc-inner {
            margin-left: 5em;
        }

        .md-toc-h5 .md-toc-inner {
            margin-left: 6.5em;
        }

        .md-toc-h6 .md-toc-inner {
            margin-left: 8em;
        }
    }

    a.md-toc-inner {
        font-size: inherit;
        font-style: inherit;
        font-weight: inherit;
        line-height: inherit;
    }

    .footnote-line a:not(.reversefootnote) {
        color: inherit;
    }

    .md-attr {
        display: none;
    }

    .md-fn-count::after {
        content: ".";
    }

    code, pre, samp, tt {
        font-family: var(--monospace);
    }

    kbd {
        margin: 0px 0.1em;
        padding: 0.1em 0.6em;
        font-size: 0.8em;
        color: rgb(36, 39, 41);
        background: rgb(255, 255, 255);
        border: 1px solid rgb(173, 179, 185);
        border-radius: 3px;
        box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset;
        white-space: nowrap;
        vertical-align: middle;
    }

    .md-comment {
        color: rgb(162, 127, 3);
        opacity: 0.8;
        font-family: var(--monospace);
    }

    code {
        text-align: left;
        vertical-align: initial;
    }

    a.md-print-anchor {
        white-space: pre !important;
        border-width: initial !important;
        border-style: none !important;
        border-color: initial !important;
        display: inline-block !important;
        position: absolute !important;
        width: 1px !important;
        right: 0px !important;
        outline: 0px !important;
        background: 0px 0px !important;
        text-decoration: initial !important;
        text-shadow: initial !important;
    }

    .md-inline-math .MathJax_SVG .noError {
        display: none !important;
    }

    .html-for-mac .inline-math-svg .MathJax_SVG {
        vertical-align: 0.2px;
    }

    .md-math-block .MathJax_SVG_Display {
        text-align: center;
        margin: 0px;
        position: relative;
        text-indent: 0px;
        max-width: none;
        max-height: none;
        min-height: 0px;
        min-width: 100%;
        width: auto;
        overflow-y: hidden;
        display: block !important;
    }

    .MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display {
        width: auto;
        margin: inherit;
        display: inline-block !important;
    }

    .MathJax_SVG .MJX-monospace {
        font-family: var(--monospace);
    }

    .MathJax_SVG .MJX-sans-serif {
        font-family: sans-serif;
    }

    .MathJax_SVG {
        display: inline;
        font-style: normal;
        font-weight: 400;
        line-height: normal;
        zoom: 90%;
        text-indent: 0px;
        text-align: left;
        text-transform: none;
        letter-spacing: normal;
        word-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        float: none;
        direction: ltr;
        max-width: none;
        max-height: none;
        min-width: 0px;
        min-height: 0px;
        border: 0px;
        padding: 0px;
        margin: 0px;
    }

    .MathJax_SVG * {
        transition: none;
    }

    .MathJax_SVG_Display svg {
        vertical-align: middle !important;
        margin-bottom: 0px !important;
    }

    .os-windows.monocolor-emoji .md-emoji {
        font-family: "Segoe UI Symbol", sans-serif;
    }

    .md-diagram-panel > svg {
        max-width: 100%;
    }

    [lang="mermaid"] svg, [lang="flow"] svg {
        max-width: 100%;
    }

    [lang="mermaid"] .node text {
        font-size: 1rem;
    }

    table tr th {
        border-bottom: 0px;
    }

    video {
        max-width: 100%;
        display: block;
        margin: 0px auto;
    }

    iframe {
        max-width: 100%;
        width: 100%;
        border: none;
    }

    .highlight td, .highlight tr {
        border: 0px;
    }


    .CodeMirror {
        height: auto;
    }

    .CodeMirror.cm-s-inner {
        background: inherit;
    }

    .CodeMirror-scroll {
        overflow-y: hidden;
        overflow-x: auto;
        z-index: 3;
    }

    .CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler {
        background-color: rgb(255, 255, 255);
    }

    .CodeMirror-gutters {
        border-right: 1px solid rgb(221, 221, 221);
        background: inherit;
        white-space: nowrap;
    }

    .CodeMirror-linenumber {
        padding: 0px 3px 0px 5px;
        text-align: right;
        color: rgb(153, 153, 153);
    }

    .cm-s-inner .cm-keyword {
        color: rgb(119, 0, 136);
    }

    .cm-s-inner .cm-atom, .cm-s-inner.cm-atom {
        color: rgb(34, 17, 153);
    }

    .cm-s-inner .cm-number {
        color: rgb(17, 102, 68);
    }

    .cm-s-inner .cm-def {
        color: rgb(0, 0, 255);
    }

    .cm-s-inner .cm-variable {
        color: rgb(0, 0, 0);
    }

    .cm-s-inner .cm-variable-2 {
        color: rgb(0, 85, 170);
    }

    .cm-s-inner .cm-variable-3 {
        color: rgb(0, 136, 85);
    }

    .cm-s-inner .cm-string {
        color: rgb(170, 17, 17);
    }

    .cm-s-inner .cm-property {
        color: rgb(0, 0, 0);
    }

    .cm-s-inner .cm-operator {
        color: rgb(152, 26, 26);
    }

    .cm-s-inner .cm-comment, .cm-s-inner.cm-comment {
        color: rgb(170, 85, 0);
    }

    .cm-s-inner .cm-string-2 {
        color: rgb(255, 85, 0);
    }

    .cm-s-inner .cm-meta {
        color: rgb(85, 85, 85);
    }

    .cm-s-inner .cm-qualifier {
        color: rgb(85, 85, 85);
    }

    .cm-s-inner .cm-builtin {
        color: rgb(51, 0, 170);
    }

    .cm-s-inner .cm-bracket {
        color: rgb(153, 153, 119);
    }

    .cm-s-inner .cm-tag {
        color: rgb(17, 119, 0);
    }

    .cm-s-inner .cm-attribute {
        color: rgb(0, 0, 204);
    }

    .cm-s-inner .cm-header, .cm-s-inner.cm-header {
        color: rgb(0, 0, 255);
    }

    .cm-s-inner .cm-quote, .cm-s-inner.cm-quote {
        color: rgb(0, 153, 0);
    }

    .cm-s-inner .cm-hr, .cm-s-inner.cm-hr {
        color: rgb(153, 153, 153);
    }

    .cm-s-inner .cm-link, .cm-s-inner.cm-link {
        color: rgb(0, 0, 204);
    }

    .cm-negative {
        color: rgb(221, 68, 68);
    }

    .cm-positive {
        color: rgb(34, 153, 34);
    }

    .cm-header, .cm-strong {
        font-weight: 700;
    }

    .cm-del {
        text-decoration: line-through;
    }

    .cm-em {
        font-style: italic;
    }

    .cm-link {
        text-decoration: underline;
    }

    .cm-error {
        color: red;
    }

    .cm-invalidchar {
        color: red;
    }

    .cm-constant {
        color: rgb(38, 139, 210);
    }

    .cm-defined {
        color: rgb(181, 137, 0);
    }

    div.CodeMirror span.CodeMirror-matchingbracket {
        color: rgb(0, 255, 0);
    }

    div.CodeMirror span.CodeMirror-nonmatchingbracket {
        color: rgb(255, 34, 34);
    }

    .cm-s-inner .CodeMirror-activeline-background {
        background: inherit;
    }

    .CodeMirror {
        position: relative;
        overflow: hidden;
    }

    .CodeMirror-scroll {
        height: 100%;
        outline: 0px;
        position: relative;
        box-sizing: content-box;
        background: inherit;
    }

    .CodeMirror-sizer {
        position: relative;
    }

    .CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar {
        position: absolute;
        z-index: 6;
        display: none;
    }

    .CodeMirror-vscrollbar {
        right: 0px;
        top: 0px;
        overflow: hidden;
    }

    .CodeMirror-hscrollbar {
        bottom: 0px;
        left: 0px;
        overflow: hidden;
    }

    .CodeMirror-scrollbar-filler {
        right: 0px;
        bottom: 0px;
    }

    .CodeMirror-gutter-filler {
        left: 0px;
        bottom: 0px;
    }

    .CodeMirror-gutters {
        position: absolute;
        left: 0px;
        top: 0px;
        padding-bottom: 30px;
        z-index: 3;
    }

    .CodeMirror-gutter {
        white-space: normal;
        height: 100%;
        box-sizing: content-box;
        padding-bottom: 30px;
        margin-bottom: -32px;
        display: inline-block;
    }

    .CodeMirror-gutter-wrapper {
        position: absolute;
        z-index: 4;
        background: 0px 0px !important;
        border: none !important;
    }

    .CodeMirror-gutter-background {
        position: absolute;
        top: 0px;
        bottom: 0px;
        z-index: 4;
    }

    .CodeMirror-gutter-elt {
        position: absolute;
        cursor: default;
        z-index: 4;
    }

    .CodeMirror-lines {
        cursor: text;
    }

    .CodeMirror pre {
        border-radius: 0px;
        border-width: 0px;
        background: 0px 0px;
        font-family: inherit;
        font-size: inherit;
        margin: 0px;
        white-space: pre;
        word-wrap: normal;
        color: inherit;
        z-index: 2;
        position: relative;
        overflow: visible;
    }

    .CodeMirror-wrap pre {
        word-wrap: break-word;
        white-space: pre-wrap;
        word-break: normal;
    }

    .CodeMirror-code pre {
        border-right: 30px solid transparent;
        width: fit-content;
    }

    .CodeMirror-wrap .CodeMirror-code pre {
        border-right: none;
        width: auto;
    }

    .CodeMirror-linebackground {
        position: absolute;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        z-index: 0;
    }

    .CodeMirror-linewidget {
        position: relative;
        z-index: 2;
        overflow: auto;
    }

    .CodeMirror-wrap .CodeMirror-scroll {
        overflow-x: hidden;
    }

    .CodeMirror-measure {
        position: absolute;
        width: 100%;
        height: 0px;
        overflow: hidden;
        visibility: hidden;
    }

    .CodeMirror-measure pre {
        position: static;
    }

    .CodeMirror div.CodeMirror-cursor {
        position: absolute;
        visibility: hidden;
        border-right: none;
        width: 0px;
    }

    .CodeMirror div.CodeMirror-cursor {
        visibility: hidden;
    }

    .CodeMirror-focused div.CodeMirror-cursor {
        visibility: inherit;
    }

    .cm-searching {
        background: rgba(255, 255, 0, 0.4);
    }

    @media print {
        .CodeMirror div.CodeMirror-cursor {
            visibility: hidden;
        }
    }


    :root {
        --side-bar-bg-color: #fff;
        --control-text-color: #777;
        --font-sans-serif: "Ubuntu", "Source Sans Pro", sans-serif !important;
        --font-monospace: "Fira Code", "Roboto Mono", monospace !important;
    }

    html {
        font-size: 16px;
    }

    body {
        font-family: var(--font-sans-serif);
        color: rgb(52, 73, 94);
        -webkit-font-smoothing: antialiased;
        line-height: 1.6rem;
        letter-spacing: 0px;
        margin: 0px;
        overflow-x: hidden;
    }

    #write {
        max-width: 860px;
        margin: 0px auto;
        padding: 20px 30px 100px;
    }

    #write p {
        line-height: 1.6rem;
        word-spacing: 0.05rem;
    }

    #write ol li {
        padding-left: 0.5rem;
    }

    #write > ul:first-child, #write > ol:first-child {
        margin-top: 30px;
    }

    body > :first-child {
        margin-top: 0px !important;
    }

    body > :last-child {
        margin-bottom: 0px !important;
    }

    a {
        color: rgb(66, 185, 131);
        font-weight: 600;
        padding: 0px 2px;
        text-decoration: none;
    }

    h1, h2, h3, h4, h5, h6 {
        position: relative;
        margin-top: 1rem;
        margin-bottom: 1rem;
        font-weight: bold;
        line-height: 1.4;
        cursor: text;
    }

    h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
        text-decoration: none;
    }

    h1 tt, h1 code {
        font-size: inherit !important;
    }

    h2 tt, h2 code {
        font-size: inherit !important;
    }

    h3 tt, h3 code {
        font-size: inherit !important;
    }

    h4 tt, h4 code {
        font-size: inherit !important;
    }

    h5 tt, h5 code {
        font-size: inherit !important;
    }

    h6 tt, h6 code {
        font-size: inherit !important;
    }

    h2 a, h3 a {
        color: rgb(52, 73, 94);
    }

    h1 {
        padding-bottom: 0.4rem;
        font-size: 2.2rem;
        line-height: 1.3;
    }

    h2 {
        font-size: 1.75rem;
        line-height: 1.225;
        margin: 35px 0px 15px;
        padding-bottom: 0.5em;
        border-bottom: 1px solid rgb(221, 221, 221);
    }

    h3 {
        font-size: 1.4rem;
        line-height: 1.43;
        margin: 20px 0px 7px;
    }

    h4 {
        font-size: 1.2rem;
    }

    h5 {
        font-size: 1rem;
    }

    h6 {
        font-size: 1rem;
        color: rgb(119, 119, 119);
    }

    p, blockquote, ul, ol, dl, table {
        margin: 0.8em 0px;
    }

    li > ol, li > ul {
        margin: 0px;
    }

    hr {
        height: 2px;
        padding: 0px;
        margin: 16px 0px;
        background-color: rgb(231, 231, 231);
        border: 0px none;
        overflow: hidden;
        box-sizing: content-box;
    }

    body > h2:first-child {
        margin-top: 0px;
        padding-top: 0px;
    }

    body > h1:first-child {
        margin-top: 0px;
        padding-top: 0px;
    }

    body > h1:first-child + h2 {
        margin-top: 0px;
        padding-top: 0px;
    }

    body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
        margin-top: 0px;
        padding-top: 0px;
    }

    a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
        margin-top: 0px;
        padding-top: 0px;
    }

    h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
        margin-top: 0px;
    }

    li p.first {
        display: inline-block;
    }

    ul, ol {
        padding-left: 30px;
    }

    ul:first-child, ol:first-child {
        margin-top: 0px;
    }

    ul:last-child, ol:last-child {
        margin-bottom: 0px;
    }

    blockquote {
        border-left: 4px solid rgb(66, 185, 131);
        padding: 10px 15px;
        color: rgb(119, 119, 119);
        background-color: rgba(66, 185, 131, 0.1);
    }

    table {
        padding: 0px;
        word-break: initial;
    }

    table tr {
        border-top: 1px solid rgb(223, 226, 229);
        margin: 0px;
        padding: 0px;
    }

    table tr:nth-child(2n), thead {
        background-color: rgb(250, 250, 250);
    }

    table tr th {
        font-weight: bold;
        border-width: 1px 1px 0px;
        border-top-style: solid;
        border-right-style: solid;
        border-left-style: solid;
        border-top-color: rgb(223, 226, 229);
        border-right-color: rgb(223, 226, 229);
        border-left-color: rgb(223, 226, 229);
        border-image: initial;
        border-bottom-style: initial;
        border-bottom-color: initial;
        text-align: left;
        margin: 0px;
        padding: 6px 13px;
    }

    table tr td {
        border: 1px solid rgb(223, 226, 229);
        text-align: left;
        margin: 0px;
        padding: 6px 13px;
    }

    table tr th:first-child, table tr td:first-child {
        margin-top: 0px;
    }

    table tr th:last-child, table tr td:last-child {
        margin-bottom: 0px;
    }

    #write strong {
        padding: 0px 1px;
    }

    #write em {
        padding: 0px 5px 0px 2px;
    }

    #write table thead th {
        background-color: rgb(242, 242, 242);
    }

    #write .CodeMirror-gutters {
        border-right: none;
    }

    #write .md-fences {
        border: 1px solid rgb(244, 244, 244);
        -webkit-font-smoothing: initial;
        line-height: 1.43rem;
        border-radius: 2px;
        font-family: var(--font-monospace);
        font-size: 0.85rem;
        word-wrap: normal;
        margin: 0.8rem 0px !important;
        padding: 0.3rem 0px !important;
        background-color: rgb(248, 248, 248) !important;
    }

    #write .CodeMirror-wrap .CodeMirror-code pre {
        padding-left: 12px;
    }

    #write code, tt {
        padding: 2px 4px;
        border-radius: 2px;
        font-family: var(--font-monospace);
        font-size: 0.92rem;
        color: rgb(233, 105, 0);
        background-color: rgb(248, 248, 248);
    }

    tt {
        margin: 0px 2px;
    }

    #write .md-footnote {
        background-color: rgb(248, 248, 248);
        color: rgb(233, 105, 0);
    }

    #write mark {
        background-color: rgb(235, 255, 235);
        border-radius: 2px;
        padding: 2px 4px;
        margin: 0px 2px;
        color: rgb(34, 34, 34);
        font-weight: 500;
    }

    #write del {
        padding: 1px 2px;
    }

    .cm-s-inner .cm-link, .cm-s-inner.cm-link {
        color: rgb(34, 162, 201);
    }

    .cm-s-inner .cm-string {
        color: rgb(34, 162, 201);
    }

    .md-task-list-item > input {
        margin-left: -1.3em;
    }

    @media print {
        html {
            font-size: 13px;
        }

        table, pre {
            break-inside: avoid;
        }

        pre {
            word-wrap: break-word;
        }
    }

    .md-fences {
        background-color: rgb(248, 248, 248);
    }

    .md-diagram-panel {
        position: static !important;
    }

    #write pre.md-meta-block {
        padding: 1rem;
        font-size: 85%;
        line-height: 1.45;
        background-color: rgb(247, 247, 247);
        border: 0px;
        border-radius: 3px;
        color: rgb(119, 119, 119);
        margin-top: 0px !important;
    }

    .mathjax-block > .code-tooltip {
        bottom: 0.375rem;
    }

    #write > h3.md-focus::before {
        left: -1.5625rem;
        top: 0.375rem;
    }

    #write > h4.md-focus::before {
        left: -1.5625rem;
        top: 0.285714rem;
    }

    #write > h5.md-focus::before {
        left: -1.5625rem;
        top: 0.285714rem;
    }

    #write > h6.md-focus::before {
        left: -1.5625rem;
        top: 0.285714rem;
    }

    .md-image > .md-meta {
        border-radius: 3px;
        font-family: var(--font-monospace);
        padding: 2px 0px 0px 4px;
        font-size: 0.9em;
        color: inherit;
    }

    .md-tag {
        color: inherit;
    }

    .md-toc {
        margin-top: 20px;
        padding-bottom: 20px;
    }

    .sidebar-tabs {
        border-bottom: none;
    }

    #typora-quick-open {
        border: 1px solid rgb(221, 221, 221);
        background-color: rgb(248, 248, 248);
    }

    #typora-quick-open-item {
        background-color: rgb(250, 250, 250);
        border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238);
        border-style: solid;
        border-width: 1px;
    }

    #md-notification::before {
        top: 10px;
    }

    .on-focus-mode blockquote {
        border-left-color: rgba(85, 85, 85, 0.12);
    }

    header, .context-menu, .megamenu-content, footer {
        font-family: var(--font-sans-serif);
    }

    .file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state {
        visibility: visible;
    }

    .mac-seamless-mode #typora-sidebar {
        background-color: var(--side-bar-bg-color);
    }

    .md-lang {
        color: rgb(180, 101, 77);
    }

    .html-for-mac .context-menu {
        --item-hover-bg-color: #E6F0FE;
    }


    .typora-export li, .typora-export p, .typora-export, .footnote-line {
        white-space: normal;
    }
    </style>
</head>
<body class='typora-export os-windows'>
<div id='write' class='is-node'><h1><a name='header-n18417' class='md-header-anchor '></a>Getting Started with Javassist
</h1>
    <h2><a name='header-n18419' class='md-header-anchor '></a>1. 读写字节码</h2>
    <p>Javassist是一个处理Java字节码的类库。ava字节码存储在一个称为class文件的二进制文件中。每个class文件包含一个Java类或接口。</p>
    <p><code>Javassist.CtClass</code> 是class的抽象表示。一个 <code>CtClass</code> (compiletime class) 对象可以用来处理一个class文件。下面是简单示例：
    </p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">ClassPool</span> <span class="cm-variable">pool</span> <span
            class="cm-operator">=</span> <span class="cm-variable">ClassPool</span>.<span
            class="cm-variable">getDefault</span>();</span></pre></div><pre class=" CodeMirror-line "
                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">CtClass</span> <span
            class="cm-variable">cc</span> <span class="cm-operator">=</span> <span class="cm-variable">pool</span>.<span
            class="cm-variable">get</span>(<span class="cm-string">"test.Rectangle"</span>);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">cc</span>.<span class="cm-variable">setSuperclass</span>(<span
            class="cm-variable">pool</span>.<span class="cm-variable">get</span>(<span
            class="cm-string">"test.Point"</span>));</span></pre><pre class=" CodeMirror-line "
                                                                      role="presentation"><span role="presentation"
                                                                                                style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">cc</span>.<span
            class="cm-variable">writeFile</span>();</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre>
    <p>This program first obtains a <code>ClassPool</code> object, which controls bytecode modification with Javassist.
        The <code>ClassPool</code> object is a container of <code>CtClass</code> object representing a class file. It
        reads a class file on demand for constructing a <code>CtClass</code> object and records the constructed object
        for responding later accesses. To modify the definition of a class, the users must first obtain from a <code>ClassPool</code>
        object a reference to a <code>CtClass</code> object representing that class. <code>get()</code> in <code>ClassPool</code>
        is used for this purpose. In the case of the program shown above, the <code>CtClass</code> object representing a
        class <code>test.Rectangle</code> is obtained from the <code>ClassPool</code> object and it is assigned to a
        variable <code>cc</code>. The <code>ClassPool</code> object returned by <code>getDefault()</code> searches the
        default system search path.</p>
    <p>From the implementation viewpoint, <code>ClassPool</code> is a hash table of <code>CtClass</code> objects, which
        uses the class names as keys. <code>get()</code> in <code>ClassPool</code> searches this hash table to find a
        <code>CtClass</code> object associated with the specified key. If such a <code>CtClass</code> object is not
        found, <code>get()</code> reads a class file to construct a new <code>CtClass</code> object, which is recorded
        in the hash table and then returned as the resulting value of <code>get()</code>.</p>
    <p>The <code>CtClass</code> object obtained from a <code>ClassPool</code> object can be modified (<a
            href='tutorial2.html#intro'>details of how to modify a <code>CtClass</code></a> will be presented later). In
        the example above, it is modified so that the superclass of <code>test.Rectangle</code> is changed into a class
        <code>test.Point</code>. This change is reflected on the original class file when <code>writeFile()</code> in
        <code>CtClass()</code> is finally called.</p>
    <p><code>writeFile()</code> 将 <code>CtClass</code> 对象转换为class文件并写入到本地硬盘。Javassist同时提供了 <code>toBytecode()</code>方法可以将其直接转化为字节码：
    </p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable-3">byte</span>[] <span class="cm-variable">b</span> <span
            class="cm-operator">=</span> <span class="cm-variable">cc</span>.<span class="cm-variable">toBytecode</span>();</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>或者直接加载：</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">Class</span> <span class="cm-variable">clazz</span> <span
            class="cm-operator">=</span> <span class="cm-variable">cc</span>.<span class="cm-variable">toClass</span>();</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p><code>toClass()</code> 请求当前线程上下文的类加载器来由 <code>CtClass</code>表示的类文件。返回一个<code>java.lang.Class</code> 对象。</p><h4><a
            name='header-n18431' class='md-header-anchor '></a>定义一个新Class</h4>
    <p>要从头定义一个新类， 可以调用<code>ClassPool</code>的<code>makeClass()</code>方法。</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">ClassPool</span> <span class="cm-variable">pool</span> <span
            class="cm-operator">=</span> <span class="cm-variable">ClassPool</span>.<span
            class="cm-variable">getDefault</span>();</span></pre></div><pre class=" CodeMirror-line "
                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">CtClass</span> <span
            class="cm-variable">cc</span> <span class="cm-operator">=</span> <span class="cm-variable">pool</span>.<span
            class="cm-variable">makeClass</span>(<span class="cm-string">"Point"</span>);</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre>
    <p>此方法定义了一个新class <code>Point</code> including no members。<code>Point</code>的方法可以通过<code>CtNewMethod</code>的工厂方法创建，并通过<code>Point</code>的<code>addMethod()</code>方法添加到<code>CtClass</code>中。
    </p>
    <p><code>makeClass()</code>不能创建接口。可以通过<code>ClassPool</code>的<code>makeInterface()</code>方法创建接口。接口的方法可以通过<code>CtNewMethod</code>的<code>abstractMethod()</code>方法创建。注意接口的方法必须为抽象方法。
    </p><h4><a name='header-n18436' class='md-header-anchor '></a>冻结classes</h4>
    <p>如果一个<code>CtClass</code>对象已经通过<code>writeFile()</code>, <code>toClass()</code>,或者<code>toBytecode()</code>转换成了class文件，Javassist将冻结<code>CtClass</code>对象。后续对<code>CtClass</code>对象的修改都是禁止的。这是为了警告开发者当一个class文件被JVM加载后，是不能再次重新加载的。
    </p>
    <p>冻结的<code>CtClass</code>可以被解冻，这样就能继续修改类定义：</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">CtClasss</span> <span class="cm-variable">cc</span> <span class="cm-operator">=</span> ...;</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  :</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">cc</span>.<span class="cm-variable">writeFile</span>();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">cc</span>.<span class="cm-variable">defrost</span>();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">cc</span>.<span class="cm-variable">setSuperclass</span>(...); &nbsp; &nbsp;<span
            class="cm-comment">// OK since the class is not frozen.</span></span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre>
    <p>如果<code>ClassPool.doPruning</code>被设置为<code>true</code>, 那么当Javassist冻结CtClass对象时，为了减少内存消耗，Javassist将修建<code>CtClass</code>中的不必要的数据结构(<code>attribute_info</code>结构)。例如，Code_attribute结构(方法体)被丢弃。因此，在<code>CtClass</code>对象被修剪之后，除了方法名、签名和注释之外，方法的字节码是不可访问的。修剪过的<code>CtClass</code>对象不能再次解冻。<code>ClassPool.doPruning</code>的默认值是<code>false</code>。
    </p>
    <p>要阻止指定<code>CtClass</code>的修剪动作，必须提前调用<code>stopPruning()</code>方法：</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">CtClasss</span> <span class="cm-variable">cc</span> <span class="cm-operator">=</span> ...;</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">cc</span>.<span class="cm-variable">stopPruning</span>(<span class="cm-atom">true</span>);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  :</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">cc</span>.<span class="cm-variable">writeFile</span>(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span
            class="cm-comment">// convert to a class file.</span></span></pre><pre class=" CodeMirror-line "
                                                                                   role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-comment">// cc is not pruned.</span></span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre>
    <p>上面的<code>CtClass</code>对象没有被修剪，因此可以在<code>writeFile()</code>之后解冻。</p>
    <p><strong>Note:</strong> 在DEBUG的时候，如果配置的<code>ClassPool.doPruning</code>为<code>true</code>，你又想暂时停止修剪和冻结，可以通过<code>debugWriteFile()</code>方法输出文件，此方法可以将配置改为<code>false</code>，并在输出完文件后解冻，然后再把配置改为<code>true</code>。
    </p><h4><a name='header-n18445' class='md-header-anchor '></a>Class搜索路径</h4>
    <p>The default <code>ClassPool</code> returned by a static method <code>ClassPool.getDefault()</code> searches the
        same path that the underlying JVM (Java virtual machine) has. <em>If a program is running on a web application
            server such as JBoss and Tomcat, the ClassPool object may not be able to find user classes</em> since such a
        web application server uses multiple class loaders as well as the system class loader. In that case, an
        additional class path must be registered to the <code>ClassPool</code>. Suppose that <code>pool</code> refers to
        a <code>ClassPool</code> object:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-variable">pool</span>.<span class="cm-variable">insertClassPath</span>(<span class="cm-keyword">new</span> <span
            class="cm-variable">ClassClassPath</span>(<span class="cm-keyword">this</span>.<span class="cm-variable">getClass</span>()));</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>This statement registers the class path that was used for loading the class of the object that <code>this</code>
        refers to. You can use any <code>Class</code> object as an argument instead of <code>this.getClass()</code>. The
        class path used for loading the class represented by that <code>Class</code> object is registered.</p>
    <p>You can register a directory name as the class search path. For example, the following code adds a directory
        <code>/usr/local/javalib</code> to the search path:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">ClassPool</span> <span class="cm-variable">pool</span> <span
            class="cm-operator">=</span> <span class="cm-variable">ClassPool</span>.<span
            class="cm-variable">getDefault</span>();</span></pre></div><pre class=" CodeMirror-line "
                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pool</span>.<span
            class="cm-variable">insertClassPath</span>(<span
            class="cm-string">"/usr/local/javalib"</span>);</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre>
    <p>The search path that the users can add is not only a directory but also a URL:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">ClassPool</span> <span class="cm-variable">pool</span> <span
            class="cm-operator">=</span> <span class="cm-variable">ClassPool</span>.<span
            class="cm-variable">getDefault</span>();</span></pre></div><pre class=" CodeMirror-line "
                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ClassPath</span> <span
            class="cm-variable">cp</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span
            class="cm-variable">URLClassPath</span>(<span class="cm-string">"www.javassist.org"</span>, <span
            class="cm-number">80</span>, <span class="cm-string">"/java/"</span>, <span class="cm-string">"org.javassist."</span>);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">pool</span>.<span class="cm-variable">insertClassPath</span>(<span class="cm-variable">cp</span>);</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre>
    <p>This program adds &quot;<a href='http://www.javassist.org:80/java/' target='_blank' class='url'>http://www.javassist.org:80/java/</a>&quot;
        to the class search path. This URL is used only for searching classes belonging to a package
        <code>org.javassist</code>. For example, to load a class <code>org.javassist.test.Main</code>, its class file
        will be obtained from:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">http</span>:<span class="cm-comment">//www.javassist.org:80/java/org/javassist/test/Main.class</span></span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>Furthermore, you can directly give a byte array to a <code>ClassPool</code> object and construct a
        <code>CtClass</code> object from that array. To do this, use <code>ByteArrayClassPath</code>. For example,</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">ClassPool</span> <span class="cm-variable">cp</span> <span class="cm-operator">=</span> <span
            class="cm-variable">ClassPool</span>.<span class="cm-variable">getDefault</span>();</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable-3">byte</span>[] <span class="cm-variable">b</span> <span
            class="cm-operator">=</span> <span class="cm-variable">a</span> <span
            class="cm-variable-3">byte</span> <span class="cm-variable">array</span>;</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span
            class="cm-keyword">class</span> <span class="cm-def">name</span>;</span></pre><pre class=" CodeMirror-line "
                                                                                               role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">cp</span>.<span
            class="cm-variable">insertClassPath</span>(<span class="cm-keyword">new</span> <span class="cm-variable">ByteArrayClassPath</span>(<span
            class="cm-variable">name</span>, <span class="cm-variable">b</span>));</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">CtClass</span> <span class="cm-variable">cc</span> <span
            class="cm-operator">=</span> <span class="cm-variable">cp</span>.<span class="cm-variable">get</span>(<span
            class="cm-variable">name</span>);</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre>
    <p>The obtained <code>CtClass</code> object represents a class defined by the class file specified by <code>b</code>.
        The <code>ClassPool</code> reads a class file from the given <code>ByteArrayClassPath</code> if
        <code>get()</code> is called and the class name given to <code>get()</code> is equal to one specified by <code>name</code>.
    </p>
    <p>If you do not know the fullyqualified name of the class, then you can use <code>makeClass()</code> in <code>ClassPool</code>:
    </p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">ClassPool</span> <span class="cm-variable">cp</span> <span class="cm-operator">=</span> <span
            class="cm-variable">ClassPool</span>.<span class="cm-variable">getDefault</span>();</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-variable">InputStream</span> <span class="cm-variable">ins</span> <span
            class="cm-operator">=</span> <span class="cm-variable">an</span> <span
            class="cm-variable">input</span> <span class="cm-variable">stream</span> <span class="cm-keyword">for</span> <span
            class="cm-variable">reading</span> <span class="cm-variable">a</span> <span class="cm-keyword">class</span> <span
            class="cm-def">file</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">CtClass</span> <span
            class="cm-variable">cc</span> <span class="cm-operator">=</span> <span class="cm-variable">cp</span>.<span
            class="cm-variable">makeClass</span>(<span
            class="cm-variable">ins</span>);</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre>
    <p><code>makeClass()</code> returns the <code>CtClass</code> object constructed from the given input stream. You can
        use <code>makeClass()</code> for eagerly feeding class files to the <code>ClassPool</code> object. This might
        improve performance if the search path includes a large jar file. Since a <code>ClassPool</code> object reads a
        class file on demand, it might repeatedly search the whole jar file for every class file.
        <code>makeClass()</code> can be used for optimizing this search. The <code>CtClass</code> constructed by <code>makeClass()</code>
        is kept in the <code>ClassPool</code> object and the class file is never read again.</p>
    <p>The users can extend the class search path. They can define a new class implementing <code>ClassPath</code>
        interface and give an instance of that class to <code>insertClassPath()</code> in <code>ClassPool</code>. This
        allows a nonstandard resource to be included in the search path.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n18463' class='md-header-anchor '></a>2. ClassPool</h2>
    <p>A <code>ClassPool</code> object is a container of <code>CtClass</code> objects. Once a <code>CtClass</code>
        object is created, it is recorded in a <code>ClassPool</code> for ever. This is because a compiler may need to
        access the <code>CtClass</code> object later when it compiles source code that refers to the class represented
        by that <code>CtClass</code>.</p>
    <p>For example, suppose that a new method <code>getter()</code> is added to a <code>CtClass</code> object
        representing <code>Point</code> class. Later, the program attempts to compile source code including a method
        call to <code>getter()</code> in <code>Point</code> and use the compiled code as the body of a method, which
        will be added to another class <code>Line</code>. If the <code>CtClass</code> object representing
        <code>Point</code> is lost, the compiler cannot compile the method call to <code>getter()</code>. Note that the
        original class definition does not include <code>getter()</code>. Therefore, to correctly compile such a method
        call, the <code>ClassPool</code> must contain all the instances of <code>CtClass</code> all the time of program
        execution.</p><h4><a name='header-n18466' class='md-header-anchor '></a>Avoid out of memory</h4>
    <p>This specification of <code>ClassPool</code> may cause huge memory consumption if the number of
        <code>CtClass</code> objects becomes amazingly large (this rarely happens since Javassist tries to reduce memory
        consumption in <a href='#frozenclasses'>various ways</a>). To avoid this problem, you can explicitly remove an
        unnecessary <code>CtClass</code> object from the <code>ClassPool</code>. If you call <code>detach()</code> on a
        <code>CtClass</code> object, then that <code>CtClass</code> object is removed from the <code>ClassPool</code>.
        For example,</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CtClass cc = ... ;</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  cc.writeFile();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  cc.detach();</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre>
    <p>You must not call any method on that <code>CtClass</code> object after <code>detach()</code> is called. However,
        you can call <code>get()</code> on <code>ClassPool</code> to make a new instance of <code>CtClass</code>
        representing the same class. If you call <code>get()</code>, the <code>ClassPool</code> reads a class file again
        and newly creates a <code>CtClass</code> object, which is returned by <code>get()</code>.</p>
    <p>Another idea is to occasionally replace a <code>ClassPool</code> with a new one and discard the old one. If an
        old <code>ClassPool</code> is garbage collected, the <code>CtClass</code> objects included in that <code>ClassPool</code>
        are also garbage collected. To create a new instance of <code>ClassPool</code>, execute the following code
        snippet:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ClassPool cp = new ClassPool(true);</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  // if needed, append an extra search path by appendClassPath()</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre>
    <p>This creates a <code>ClassPool</code> object that behaves as the default <code>ClassPool</code> returned by
        <code>ClassPool.getDefault()</code> does. Note that <code>ClassPool.getDefault()</code> is a singleton factory
        method provided for convenience. It creates a <code>ClassPool</code> object in the same way shown above although
        it keeps a single instance of <code>ClassPool</code> and reuses it. A <code>ClassPool</code> object returned by
        <code>getDefault()</code> does not have a special role. <code>getDefault()</code> is a convenience method.</p>
    <p>Note that <code>new ClassPool(true)</code> is a convenient constructor, which constructs a <code>ClassPool</code>
        object and appends the system search path to it. Calling that constructor is equivalent to the following code:
    </p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ClassPool cp = new ClassPool();</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  cp.appendSystemPath();  // or append another path by appendClassPath()</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre>
    <h4><a name='header-n18475' class='md-header-anchor '></a>Cascaded ClassPools</h4>
    <p><em>If a program is running on a web application server,</em> creating multiple instances of
        <code>ClassPool</code> might be necessary; an instance of <code>ClassPool</code> should be created for each
        class loader (i.e. container). The program should create a <code>ClassPool</code> object by not calling <code>getDefault()</code>
        but a constructor of <code>ClassPool</code>.</p>
    <p>Multiple <code>ClassPool</code> objects can be cascaded like <code>java.lang.ClassLoader</code>. For example,</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ClassPool parent = ClassPool.getDefault();</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ClassPool child = new ClassPool(parent);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  child.insertClassPath("./classes");</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre>
    <p>If <code>child.get()</code> is called, the child <code>ClassPool</code> first delegates to the parent <code>ClassPool</code>.
        If the parent <code>ClassPool</code> fails to find a class file, then the child <code>ClassPool</code> attempts
        to find a class file under the <code>./classes</code> directory.</p>
    <p>If <code>child.childFirstLookup</code> is true, the child <code>ClassPool</code> attempts to find a class file
        before delegating to the parent <code>ClassPool</code>. For example,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18481"
         mdtype="fences">  ClassPool parent = ClassPool.getDefault();
  ClassPool child = new ClassPool(parent);
  child.appendSystemPath();         // the same class path as the default one.
  child.childFirstLookup = true;    // changes the behavior of the child.
</pre>
    <h4><a name='header-n18482' class='md-header-anchor '></a>改变已有class名称来定义新class</h4>
    <p>A new class can be defined as a copy of an existing class. The program below does that:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18484"
         mdtype="fences">  ClassPool pool = ClassPool.getDefault();
  CtClass cc = pool.get("Point");
  cc.setName("Pair");
</pre>
    <p>This program first obtains the <code>CtClass</code> object for class <code>Point</code>. Then it calls <code>setName()</code>
        to give a new name <code>Pair</code> to that <code>CtClass</code> object. After this call, all occurrences of
        the class name in the class definition represented by that <code>CtClass</code> object are changed from <code>Point</code>
        to <code>Pair</code>. The other part of the class definition does not change.</p>
    <p>Note that <code>setName()</code> in <code>CtClass</code> changes a record in the <code>ClassPool</code> object.
        From the implementation viewpoint, a <code>ClassPool</code> object is a hash table of <code>CtClass</code>
        objects. <code>setName()</code> changes the key associated to the <code>CtClass</code> object in the hash table.
        The key is changed from the original class name to the new class name.</p>
    <p>Therefore, if <code>get(&quot;Point&quot;)</code> is later called on the <code>ClassPool</code> object again,
        then it never returns the <code>CtClass</code> object that the variable <code>cc</code> refers to. The <code>ClassPool</code>
        object reads a class file <code>Point.class</code> again and it constructs a new <code>CtClass</code> object for
        class <code>Point</code>. This is because the <code>CtClass</code> object associated with the name
        <code>Point</code> does not exist any more. See the followings:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18488"
         mdtype="fences">  ClassPool pool = ClassPool.getDefault();
  CtClass cc = pool.get("Point");
  CtClass cc1 = pool.get("Point");   // cc1 is identical to cc.
  cc.setName("Pair");
  CtClass cc2 = pool.get("Pair");    // cc2 is identical to cc.
  CtClass cc3 = pool.get("Point");   // cc3 is not identical to cc.
</pre>
    <p><code>cc1</code> and <code>cc2</code> refer to the same instance of <code>CtClass</code> that <code>cc</code>
        does whereas <code>cc3</code> does not. Note that, after <code>cc.setName(&quot;Pair&quot;)</code> is executed,
        the <code>CtClass</code> object that <code>cc</code> and <code>cc1</code> refer to represents the
        <code>Pair</code> class.</p>
    <p>The <code>ClassPool</code> object is used to maintain onetoone mapping between classes and <code>CtClass</code>
        objects. Javassist never allows two distinct <code>CtClass</code> objects to represent the same class unless two
        independent <code>ClassPool</code> are created. This is a significant feature for consistent program
        transformation.</p>
    <p>To create another copy of the default instance of <code>ClassPool</code>, which is returned by <code>ClassPool.getDefault()</code>,
        execute the following code snippet (this code was already <a href='#avoidmemory'>shown above</a>):</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18492"
         mdtype="fences">  ClassPool cp = new ClassPool(true);
</pre>
    <p>If you have two <code>ClassPool</code> objects, then you can obtain, from each <code>ClassPool</code>, a distinct
        <code>CtClass</code> object representing the same class file. You can differently modify these
        <code>CtClass</code> objects to generate different versions of the class.</p><h4><a name='header-n18494'
                                                                                            class='md-header-anchor '></a>改变冻结class名称来定义新class
    </h4>
    <p>Once a <code>CtClass</code> object is converted into a class file by <code>writeFile()</code> or <code>toBytecode()</code>,
        Javassist rejects further modifications of that <code>CtClass</code> object. Hence, after the
        <code>CtClass</code> object representing <code>Point</code> class is converted into a class file, you cannot
        define <code>Pair</code> class as a copy of <code>Point</code> since executing <code>setName()</code> on <code>Point</code>
        is rejected. The following code snippet is wrong:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18496"
         mdtype="fences">  ClassPool pool = ClassPool.getDefault();
  CtClass cc = pool.get("Point");
  cc.writeFile();
  cc.setName("Pair");    // wrong since writeFile() has been called.
</pre>
    <p>To avoid this restriction, you should call <code>getAndRename()</code> in <code>ClassPool</code>. For example,
    </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18498"
         mdtype="fences">  ClassPool pool = ClassPool.getDefault();
  CtClass cc = pool.get("Point");
  cc.writeFile();
  CtClass cc2 = pool.getAndRename("Point", "Pair");
</pre>
    <p>If <code>getAndRename()</code> is called, the <code>ClassPool</code> first reads <code>Point.class</code> for
        creating a new <code>CtClass</code> object representing <code>Point</code> class. However, it renames that
        <code>CtClass</code> object from <code>Point</code> to <code>Pair</code> before it records that
        <code>CtClass</code> object in a hash table. Thus <code>getAndRename()</code> can be executed after <code>writeFile()</code>
        or <code>toBytecode()</code> is called on the the <code>CtClass</code> object representing <code>Point</code>
        class.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n18501' class='md-header-anchor '></a>3. Class加载器</h2>
    <p>如果提前知道要修改的class，最简单的方式如下：</p>
    <p> Get a <code>CtClass</code> object by calling <code>ClassPool.get()</code>,
        Modify it, and
        Call <code>writeFile()</code> or <code>toBytecode()</code> on that <code>CtClass</code> object to obtain a
        modified class file.</p>
    <p>
        如果一个class是否被修改是在加载时才能确定，就必须让javassist和类加载器一起协作。javassist可以和类加载器一起工作，这样就可以在加载时修改字节码，你可以使用自定义的类加载器，也可以使用javassist提供的类加载器。</p>
    <h3><a name='header-n18505' class='md-header-anchor '></a>3.1 The <code>toClass</code> method in
        <code>CtClass</code></h3>
    <p>The <code>CtClass</code> provides a convenience method <code>toClass()</code>, which requests the context class
        loader for the current thread to load the class represented by the <code>CtClass</code> object. To call this
        method, the caller must have appropriate permission; otherwise, a <code>SecurityException</code> may be thrown.
    </p>
    <p>The following program shows how to use <code>toClass()</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18508"
         mdtype="fences" style="break-inside: unset;">  public class Hello {
      public void say() {
          System.out.println("Hello");
      }
  }

  public class Test {
      public static void main(String[] args) throws Exception {
          ClassPool cp = ClassPool.getDefault();
          CtClass cc = cp.get("Hello");
          CtMethod m = cc.getDeclaredMethod("say");
          m.insertBefore("{ System.out.println(\"Hello.say():\"); }");
          Class c = cc.toClass();
          Hello h = (Hello)c.newInstance();
          h.say();
      }
  }
</pre>
    <p><code>Test.main()</code> inserts a call to <code>println()</code> in the method body of <code>say()</code> in
        <code>Hello</code>. Then it constructs an instance of the modified <code>Hello</code> class and calls <code>say()</code>
        on that instance.</p>
    <p>Note that the program above depends on the fact that the <code>Hello</code> class is never loaded before <code>toClass()</code>
        is invoked. If not, the JVM would load the original <code>Hello</code> class before <code>toClass()</code>
        requests to load the modified <code>Hello</code> class. Hence loading the modified <code>Hello</code> class
        would be failed (<code>LinkageError</code> is thrown). For example, if <code>main()</code> in <code>Test</code>
        is something like this:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18511"
         mdtype="fences">  public static void main(String[] args) throws Exception {
      Hello orig = new Hello();
      ClassPool cp = ClassPool.getDefault();
      CtClass cc = cp.get("Hello");
          :
  }
</pre>
    <p>then the original <code>Hello</code> class is loaded at the first line of <code>main</code> and the call to
        <code>toClass()</code> throws an exception since the class loader cannot load two different versions of the
        <code>Hello</code> class at the same time.</p>
    <p><em>If the program is running on some application server such as JBoss and Tomcat,</em> the context class loader
        used by <code>toClass()</code> might be inappropriate. In this case, you would see an unexpected <code>ClassCastException</code>.
        To avoid this exception, you must explicitly give an appropriate class loader to <code>toClass()</code>. For
        example, if <code>bean</code> is your session bean object, then the following code:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18514"
         mdtype="fences">  CtClass cc = ...;
  Class c = cc.toClass(bean.getClass().getClassLoader());
</pre>
    <p>would work. You should give <code>toClass()</code> the class loader that has loaded your program (in the above
        example, the class of the <code>bean</code> object).</p>
    <p><code>toClass()</code> is provided for convenience. If you need more complex functionality, you should write your
        own class loader.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n18518' class='md-header-anchor '></a>3.2 Class loading in Java</h3>
    <p>In Java, multiple class loaders can coexist and each class loader creates its own name space. Different class
        loaders can load different class files with the same class name. The loaded two classes are regarded as
        different ones. This feature enables us to run multiple application programs on a single JVM even if these
        programs include different classes with the same name.</p>
    <p><strong>Note:</strong> The JVM does not allow dynamically reloading a class. Once a class loader loads a class,
        it cannot reload a modified version of that class during runtime. Thus, you cannot alter the definition of a
        class after the JVM loads it. However, the JPDA (Java Platform Debugger Architecture) provides limited ability
        for reloading a class. See <a href='#hotswap'>Section 3.6</a>.</p>
    <p>If the same class file is loaded by two distinct class loaders, the JVM makes two distinct classes with the same
        name and definition. The two classes are regarded as different ones. Since the two classes are not identical, an
        instance of one class is not assignable to a variable of the other class. The cast operation between the two
        classes fails and throws a <em>ClassCastException</em>.</p>
    <p>For example, the following code snippet throws an exception:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18523"
         mdtype="fences">  MyClassLoader myLoader = new MyClassLoader();
  Class clazz = myLoader.loadClass("Box");
  Object obj = clazz.newInstance();
  Box b = (Box)obj;    // this always throws ClassCastException.
</pre>
    <p>The <code>Box</code> class is loaded by two class loaders. Suppose that a class loader CL loads a class including
        this code snippet. Since this code snippet refers to <code>MyClassLoader</code>, <code>Class</code>, <code>Object</code>,
        and <code>Box</code>, CL also loads these classes (unless it delegates to another class loader). Hence the type
        of the variable <code>b</code> is the <code>Box</code> class loaded by CL. On the other hand,
        <code>myLoader</code> also loads the <code>Box</code> class. The object <code>obj</code> is an instance of the
        <code>Box</code> class loaded by <code>myLoader</code>. Therefore, the last statement always throws a <code>ClassCastException</code>
        since the class of <code>obj</code> is a different verison of the <code>Box</code> class from one used as the
        type of the variable <code>b</code>.</p>
    <p>Multiple class loaders form a tree structure. Each class loader except the bootstrap loader has a parent class
        loader, which has normally loaded the class of that child class loader. Since the request to load a class can be
        delegated along this hierarchy of class loaders, a class may be loaded by a class loader that you do not request
        the class loading. Therefore, the class loader that has been requested to load a class C may be different from
        the loader that actually loads the class C. For distinction, we call the former loader <em>the initiator of
            C</em> and we call the latter loader <em>the real loader of C</em>.</p>
    <p>Furthermore, if a class loader CL requested to load a class C (the initiator of C) delegates to the parent class
        loader PL, then the class loader CL is never requested to load any classes referred to in the definition of the
        class C. CL is not the initiator of those classes. Instead, the parent class loader PL becomes their initiators
        and it is requested to load them. <em>The classes that the definition of a class C referes to are loaded by the
            real loader of C.</em></p>
    <p>To understand this behavior, let&#39;s consider the following example.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18528"
         mdtype="fences" style="break-inside: unset;">  public class Point {    // loaded by PL
      private int x, y;
      public int getX() { return x; }
          :
  }

  public class Box {      // the initiator is L but the real loader is PL
      private Point upperLeft, size;
      public int getBaseX() { return upperLeft.x; }
          :
  }

  public class Window {    // loaded by a class loader L
      private Box box;
      public int getBaseX() { return box.getBaseX(); }
  }
</pre>
    <p>Suppose that a class <code>Window</code> is loaded by a class loader L. Both the initiator and the real loader of
        <code>Window</code> are L. Since the definition of <code>Window</code> refers to <code>Box</code>, the JVM will
        request L to load <code>Box</code>. Here, suppose that L delegates this task to the parent class loader PL. The
        initiator of <code>Box</code> is L but the real loader is PL. In this case, the initiator of <code>Point</code>
        is not L but PL since it is the same as the real loader of <code>Box</code>. Thus L is never requested to load
        <code>Point</code>.</p>
    <p>Next, let&#39;s consider a slightly modified example.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18531"
         mdtype="fences" style="break-inside: unset;">  public class Point {
      private int x, y;
      public int getX() { return x; }
          :
  }

  public class Box {      // the initiator is L but the real loader is PL
      private Point upperLeft, size;
      public Point getSize() { return size; }
          :
  }

  public class Window {    // loaded by a class loader L
      private Box box;
      public boolean widthIs(int w) {
          Point p = box.getSize();
          return w == p.getX();
      }
  }
</pre>
    <p>Now, the definition of <code>Window</code> also refers to <code>Point</code>. In this case, the class loader L
        must also delegate to PL if it is requested to load <code>Point</code>. <em>You must avoid having two class
            loaders doubly load the same class.</em> One of the two loaders must delegate to the other.</p>
    <p>If L does not delegate to PL when <code>Point</code> is loaded, <code>widthIs()</code> would throw a
        ClassCastException. Since the real loader of <code>Box</code> is PL, <code>Point</code> referred to in
        <code>Box</code> is also loaded by PL. Therefore, the resulting value of <code>getSize()</code> is an instance
        of <code>Point</code> loaded by PL whereas the type of the variable <code>p</code> in <code>widthIs()</code> is
        <code>Point</code> loaded by L. The JVM regards them as distinct types and thus it throws an exception because
        of type mismatch.</p>
    <p>This behavior is somewhat inconvenient but necessary. If the following statement:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18535"
         mdtype="fences">  Point p = box.getSize();
</pre>
    <p>did not throw an exception, then the programmer of <code>Window</code> could break the encapsulation of <code>Point</code>
        objects. For example, the field <code>x</code> is private in <code>Point</code> loaded by PL. However, the
        <code>Window</code> class could directly access the value of <code>x</code> if L loads <code>Point</code> with
        the following definition:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18537"
         mdtype="fences">  public class Point {
      public int x, y;    // not private
      public int getX() { return x; }
          :
  }
</pre>
    <p>For more details of class loaders in Java, the following paper would be helpful:</p>
    <p>Sheng Liang and Gilad Bracha, &quot;Dynamic Class Loading in the Java Virtual Machine&quot;, <em>ACM OOPSLA&#39;98</em>,
        pp.3644, 1998.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n18541' class='md-header-anchor '></a>3.3 Using <code>javassist.Loader</code></h3>
    <p>Javassist provides a class loader <code>javassist.Loader</code>. This class loader uses a <code>javassist.ClassPool</code>
        object for reading a class file.</p>
    <p>For example, <code>javassist.Loader</code> can be used for loading a particular class modified with Javassist.
    </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18544"
         mdtype="fences" style="break-inside: unset;">  import javassist.*;
  import test.Rectangle;

  public class Main {
    public static void main(String[] args) throws Throwable {
       ClassPool pool = ClassPool.getDefault();
       Loader cl = new Loader(pool);

       CtClass ct = pool.get("test.Rectangle");
       ct.setSuperclass(pool.get("test.Point"));

       Class c = cl.loadClass("test.Rectangle");
       Object rect = c.newInstance();
           :
    }
  }
</pre>
    <p>This program modifies a class <code>test.Rectangle</code>. The superclass of <code>test.Rectangle</code> is set
        to a <code>test.Point</code> class. Then this program loads the modified class, and creates a new instance of
        the <code>test.Rectangle</code> class.</p>
    <p>If the users want to modify a class on demand when it is loaded, the users can add an event listener to a <code>javassist.Loader</code>.
        The added event listener is notified when the class loader loads a class. The eventlistener class must implement
        the following interface:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18547"
         mdtype="fences">  public interface Translator {
      public void start(ClassPool pool)
          throws NotFoundException, CannotCompileException;
      public void onLoad(ClassPool pool, String classname)
          throws NotFoundException, CannotCompileException;
  }
</pre>
    <p>The method <code>start()</code> is called when this event listener is added to a <code>javassist.Loader</code>
        object by <code>addTranslator()</code> in <code>javassist.Loader</code>. The method <code>onLoad()</code> is
        called before <code>javassist.Loader</code> loads a class. <code>onLoad()</code> can modify the definition of
        the loaded class.</p>
    <p>For example, the following event listener changes all classes to public classes just before they are loaded.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18550"
         mdtype="fences">  public class MyTranslator implements Translator {
      void start(ClassPool pool)
          throws NotFoundException, CannotCompileException {}
      void onLoad(ClassPool pool, String classname)
          throws NotFoundException, CannotCompileException
      {
          CtClass cc = pool.get(classname);
          cc.setModifiers(Modifier.PUBLIC);
      }
  }
</pre>
    <p>Note that <code>onLoad()</code> does not have to call <code>toBytecode()</code> or <code>writeFile()</code> since
        <code>javassist.Loader</code> calls these methods to obtain a class file.</p>
    <p>To run an application class <code>MyApp</code> with a <code>MyTranslator</code> object, write a main class as
        following:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18553"
         mdtype="fences">  import javassist.*;

  public class Main2 {
    public static void main(String[] args) throws Throwable {
       Translator t = new MyTranslator();
       ClassPool pool = ClassPool.getDefault();
       Loader cl = new Loader();
       cl.addTranslator(pool, t);
       cl.run("MyApp", args);
    }
  }
</pre>
    <p>To run this program, do:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18555"
         mdtype="fences">  % java Main2 arg1 arg2...
</pre>
    <p>The class <code>MyApp</code> and the other application classes are translated by <code>MyTranslator</code>.</p>
    <p>Note that <em>application</em> classes like <code>MyApp</code> cannot access the <em>loader</em> classes such as
        <code>Main2</code>, <code>MyTranslator</code>, and <code>ClassPool</code> because they are loaded by different
        loaders. The application classes are loaded by <code>javassist.Loader</code> whereas the loader classes such as
        <code>Main2</code> are by the default Java class loader.</p>
    <p><code>javassist.Loader</code> searches for classes in a different order from <code>java.lang.ClassLoader</code>.
        <code>ClassLoader</code> first delegates the loading operations to the parent class loader and then attempts to
        load the classes only if the parent class loader cannot find them. On the other hand,
        <code>javassist.Loader</code> attempts to load the classes before delegating to the parent class loader. It
        delegates only if:</p>
    <p> the classes are not found by calling<code>get()</code> on a <code>ClassPool</code> object, or
        the classes have been specified by using <code>delegateLoadingOf()</code> to be loaded by the parent class
        loader.</p>
    <p>This search order allows loading modified classes by Javassist. However, it delegates to the parent class loader
        if it fails to find modified classes for some reason. Once a class is loaded by the parent class loader, the
        other classes referred to in that class will be also loaded by the parent class loader and thus they are never
        modified. Recall that all the classes referred to in a class C are loaded by the real loader of C. <em>If your
            program fails to load a modified class,</em> you should make sure whether all the classes using that class
        have been loaded by <code>javassist.Loader</code>.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n18562' class='md-header-anchor '></a>3.4 Writing a class loader</h3>
    <p>A simple class loader using Javassist is as follows:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18564"
         mdtype="fences" style="break-inside: unset;">  import javassist.*;

  public class SampleLoader extends ClassLoader {
      /* Call MyApp.main().
       */
      public static void main(String[] args) throws Throwable {
          SampleLoader s = new SampleLoader();
          Class c = s.loadClass("MyApp");
          c.getDeclaredMethod("main", new Class[] { String[].class })
           .invoke(null, new Object[] { args });
      }

      private ClassPool pool;

      public SampleLoader() throws NotFoundException {
          pool = new ClassPool();
          pool.insertClassPath("./class"); // MyApp.class must be there.
      }

      /* Finds a specified class.
       * The bytecode for that class can be modified.
       */
      protected Class findClass(String name) throws ClassNotFoundException {
          try {
              CtClass cc = pool.get(name);
              // modify the CtClass object here
              byte[] b = cc.toBytecode();
              return defineClass(name, b, 0, b.length);
          } catch (NotFoundException e) {
              throw new ClassNotFoundException();
          } catch (IOException e) {
              throw new ClassNotFoundException();
          } catch (CannotCompileException e) {
              throw new ClassNotFoundException();
          }
      }
  }
</pre>
    <p>The class <code>MyApp</code> is an application program. To execute this program, first put the class file under
        the <code>./class</code> directory, which must <em>not</em> be included in the class search path. Otherwise,
        <code>MyApp.class</code> would be loaded by the default system class loader, which is the parent loader of
        <code>SampleLoader</code>. The directory name <code>./class</code> is specified by
        <code>insertClassPath()</code> in the constructor. You can choose a different name instead of
        <code>./class</code> if you want. Then do as follows:</p>
    <p><code>% java SampleLoader</code></p>
    <p>The class loader loads the class <code>MyApp</code> (<code>./class/MyApp.class</code>) and calls <code>MyApp.main()</code>
        with the command line parameters.</p>
    <p>This is the simplest way of using Javassist. However, if you write a more complex class loader, you may need
        detailed knowledge of Java&#39;s class loading mechanism. For example, the program above puts the
        <code>MyApp</code> class in a name space separated from the name space that the class <code>SampleLoader</code>
        belongs to because the two classes are loaded by different class loaders. Hence, the <code>MyApp</code> class
        cannot directly access the class <code>SampleLoader</code>.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n18570' class='md-header-anchor '></a>3.5 Modifying a system class</h3>
    <p>The system classes like <code>java.lang.String</code> cannot be loaded by a class loader other than the system
        class loader. Therefore, <code>SampleLoader</code> or <code>javassist.Loader</code> shown above cannot modify
        the system classes at loading time.</p>
    <p>If your application needs to do that, the system classes must be <em>statically</em> modified. For example, the
        following program adds a new field <code>hiddenValue</code> to <code>java.lang.String</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18573"
         mdtype="fences">  ClassPool pool = ClassPool.getDefault();
  CtClass cc = pool.get("java.lang.String");
  CtField f = new CtField(CtClass.intType, "hiddenValue", cc);
  f.setModifiers(Modifier.PUBLIC);
  cc.addField(f);
  cc.writeFile(".");
</pre>
    <p>This program produces a file <code>&quot;./java/lang/String.class&quot;</code>.</p>
    <p>To run your program <code>MyApp</code> with this modified <code>String</code> class, do as follows:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18576"
         mdtype="fences">  % java Xbootclasspath/p:. MyApp arg1 arg2...
</pre>
    <p>Suppose that the definition of <code>MyApp</code> is as follows:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18578"
         mdtype="fences">  public class MyApp {
      public static void main(String[] args) throws Exception {
          System.out.println(String.class.getField("hiddenValue").getName());
      }
  }
</pre>
    <p>If the modified <code>String</code> class is correctly loaded, <code>MyApp</code> prints <code>hiddenValue</code>.
    </p>
    <p><em>Note: Applications that use this technique for the purpose of overriding a system class in rt.jar should not
        be deployed as doing so would contravene the Java 2 Runtime Environment binary code license.</em></p>
    <p>&nbsp;</p>
    <h3><a name='header-n18582' class='md-header-anchor '></a>3.6 Reloading a class at runtime</h3>
    <p>If the JVM is launched with the JPDA (Java Platform Debugger Architecture) enabled, a class is dynamically
        reloadable. After the JVM loads a class, the old version of the class definition can be unloaded and a new one
        can be reloaded again. That is, the definition of that class can be dynamically modified during runtime.
        However, the new class definition must be somewhat compatible to the old one. <em>The JVM does not allow schema
            changes between the two versions.</em> They have the same set of methods and fields.</p>
    <p>Javassist provides a convenient class for reloading a class at runtime. For more information, see the API
        documentation of <code>javassist.tools.HotSwapper</code>.</p>
    <h2><a name='header-n18585' class='md-header-anchor '></a>4. Introspection and customization</h2>
    <p><code>CtClass</code> provides methods for introspection. The introspective ability of Javassist is compatible
        with that of the Java reflection API. <code>CtClass</code> provides <code>getName()</code>, <code>getSuperclass()</code>,
        <code>getMethods()</code>, and so on. <code>CtClass</code> also provides methods for modifying a class
        definition. It allows to add a new field, constructor, and method. Instrumenting a method body is also possible.
    </p>
    <p>Methods are represented by <code>CtMethod</code> objects. <code>CtMethod</code> provides several methods for
        modifying the definition of the method. Note that if a method is inherited from a super class, then the same
        <code>CtMethod</code> object that represents the inherited method represents the method declared in that super
        class. A <code>CtMethod</code> object corresponds to every method declaration.</p>
    <p>For example, if class <code>Point</code> declares method <code>move()</code> and a subclass
        <code>ColorPoint</code> of <code>Point</code> does not override <code>move()</code>, the two <code>move()</code>
        methods declared in <code>Point</code> and inherited in <code>ColorPoint</code> are represented by the identical
        <code>CtMethod</code> object. If the method definition represented by this <code>CtMethod</code> object is
        modified, the modification is reflected on both the methods. If you want to modify only the <code>move()</code>
        method in <code>ColorPoint</code>, you first have to add to <code>ColorPoint</code> a copy of the
        <code>CtMethod</code> object representing <code>move()</code> in <code>Point</code>. A copy of the the <code>CtMethod</code>
        object can be obtained by <code>CtNewMethod.copy()</code>.</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>Javassist does not allow to remove a method or field, but it allows to change the name. So if a method is not
        necessary any more, it should be renamed and changed to be a private method by calling <code>setName()</code>
        and <code>setModifiers()</code> declared in <code>CtMethod</code>.</p>
    <p>Javassist does not allow to add an extra parameter to an existing method, either. Instead of doing that, a new
        method receiving the extra parameter as well as the other parameters should be added to the same class. For
        example, if you want to add an extra <code>int</code> parameter <code>newZ</code> to a method:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18593"
         mdtype="fences">    void move(int newX, int newY) { x = newX; y = newY; }
</pre>
    <p> in a <code>Point</code> class, then you should add the following method to the <code>Point</code> class:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18595"
         mdtype="fences">    void move(int newX, int newY, int newZ) {
        // do what you want with newZ.
        move(newX, newY);
    }
</pre>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>Javassist also provides lowlevel API for directly editing a raw class file. For example,
        <code>getClassFile()</code> in <code>CtClass</code> returns a <code>ClassFile</code> object representing a raw
        class file. <code>getMethodInfo()</code> in <code>CtMethod</code> returns a <code>MethodInfo</code> object
        representing a <code>method_info</code> structure included in a class file. The lowlevel API uses the vocabulary
        from the Java Virtual machine specification. The users must have the knowledge about class files and bytecode.
        For more details, the users should see the <a href='tutorial3.html#intro'><code>javassist.bytecode</code>
            package</a>.</p>
    <p>The class files modified by Javassist requires the <code>javassist.runtime</code> package for runtime support
        only if some special identifiers starting with <code>$</code> are used. Those special identifiers are described
        below. The class files modified without those special identifiers do not need the <code>javassist.runtime</code>
        package or any other Javassist packages at runtime. For more details, see the API documentation of the <code>javassist.runtime</code>
        package.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n18601' class='md-header-anchor '></a>4.1 Inserting source text at the beginning/end of a method
        body</h3>
    <p><code>CtMethod</code> and <code>CtConstructor</code> provide methods <code>insertBefore()</code>, <code>insertAfter()</code>,
        and <code>addCatch()</code>. They are used for inserting a code fragment into the body of an existing method.
        The users can specify those code fragments with <em>source text</em> written in Java. Javassist includes a
        simple Java compiler for processing source text. It receives source text written in Java and compiles it into
        Java bytecode, which will be <em>inlined</em> into a method body.</p>
    <p>Inserting a code fragment at the position specified by a line number is also possible (if the line number table
        is contained in the class file). <code>insertAt()</code> in <code>CtMethod</code> and <code>CtConstructor</code>
        takes source text and a line number in the source file of the original class definition. It compiles the source
        text and inserts the compiled code at the line number.</p>
    <p>The methods <code>insertBefore()</code>, <code>insertAfter()</code>, <code>addCatch()</code>, and <code>insertAt()</code>
        receive a <code>String</code> object representing a statement or a block. A statement is a single control
        structure like <code>if</code> and <code>while</code> or an expression ending with a semi colon (<code>;</code>).
        A block is a set of statements surrounded with braces <code>{}</code>. Hence each of the following lines is an
        example of valid statement or block:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18605"
         mdtype="fences">  System.out.println("Hello");
  { System.out.println("Hello"); }
  if (i &lt; 0) { i = i; }
</pre>
    <p>The statement and the block can refer to fields and methods. They can also refer to the parameters to the method
        that they are inserted into if that method was compiled with the g option (to include a local variable attribute
        in the class file). Otherwise, they must access the method parameters through the special variables
        <code>$0</code>, <code>$1</code>, <code>$2</code>, ... described below. <em>Accessing local variables declared
            in the method is not allowed</em> although declaring a new local variable in the block is allowed. However,
        <code>insertAt()</code> allows the statement and the block to access local variables if these variables are
        available at the specified line number and the target method was compiled with the g option.</p>
    <p>The <code>String</code> object passed to the methods <code>insertBefore()</code>, <code>insertAfter()</code>,
        <code>addCatch()</code>, and <code>insertAt()</code> are compiled by the compiler included in Javassist. Since
        the compiler supports language extensions, several identifiers starting with <code>$</code> have special
        meaning:</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>标识符</th>
                <th>含义</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0, $1, $2, ...</code></td>
                <td>this and actual parameters</td>
            </tr>
            <tr>
                <td><code>$args</code></td>
                <td>An array of parameters. The type of $args is Object[].</td>
            </tr>
            <tr>
                <td><code>$$</code></td>
                <td>All actual parameters.</td>
            </tr>
            <tr>
                <td><code>$</code></td>
                <td>For example, m($$) is equivalent to m($1,$2,...)</td>
            </tr>
            <tr>
                <td><code>$cflow(...)</code></td>
                <td>cflow variable</td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>The result type. It is used in a cast expression.</td>
            </tr>
            <tr>
                <td><code>$w</code></td>
                <td>The wrapper type. It is used in a cast expression.</td>
            </tr>
            <tr>
                <td><code>$_</code></td>
                <td>The resulting value</td>
            </tr>
            <tr>
                <td><code>$sig</code></td>
                <td>An array of java.lang.Class objects representing the formal parameter types.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A java.lang.Class object representing the formal result type.</td>
            </tr>
            <tr>
                <td><code>$class</code></td>
                <td>A java.lang.Class object representing the class currently edited.</td>
            </tr>
            </tbody>
        </table>
    </figure>
    <h4><a name='header-n18645' class='md-header-anchor '></a><code>$0, $1, $2</code>, ...</h4>
    <p>The parameters passed to the target method are accessible with <code>$1</code>, <code>$2</code>, ... instead of
        the original parameter names. <code>$1</code> represents the first parameter, <code>$2</code> represents the
        second parameter, and so on. The types of those variables are identical to the parameter types. <code>$0</code>
        is equivalent to <code>this</code>. If the method is static, <code>$0</code> is not available.</p>
    <p>These variables are used as following. Suppose that a class <code>Point</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18648"
         mdtype="fences">class Point {
    int x, y;
    void move(int dx, int dy) { x += dx; y += dy; }
}
</pre>
    <p>To print the values of <code>dx</code> and <code>dy</code> whenever the method <code>move()</code> is called,
        execute this program:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18650"
         mdtype="fences">  ClassPool pool = ClassPool.getDefault();
  CtClass cc = pool.get("Point");
  CtMethod m = cc.getDeclaredMethod("move");
  m.insertBefore("{ System.out.println($1); System.out.println($2); }");
  cc.writeFile();
</pre>
    <p>Note that the source text passed to <code>insertBefore()</code> is surrounded with braces <code>{}</code>. <code>insertBefore()</code>
        accepts only a single statement or a block surrounded with braces.</p>
    <p>The definition of the class <code>Point</code> after the modification is like this:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18653"
         mdtype="fences">class Point {
    int x, y;
    void move(int dx, int dy) {
        { System.out.println(dx); System.out.println(dy); }
        x += dx; y += dy;
    }
}
</pre>
    <p><code>$1</code> and <code>$2</code> are replaced with <code>dx</code> and <code>dy</code>, respectively.</p>
    <p><code>$1</code>, <code>$2</code>, <code>$3</code> ... are updatable. If a new value is assigend to one of those
        variables, then the value of the parameter represented by that variable is also updated.</p><h4><a
            name='header-n18656' class='md-header-anchor '></a><code>$args</code></h4>
    <p>The variable <code>$args</code> represents an array of all the parameters. The type of that variable is an array
        of class <code>Object</code>. If a parameter type is a primitive type such as <code>int</code>, then the
        parameter value is converted into a wrapper object such as <code>java.lang.Integer</code> to store in <code>$args</code>.
        Thus, <code>$args[0]</code> is equivalent to <code>$1</code> unless the type of the first parameter is a
        primitive type. Note that <code>$args[0]</code> is not equivalent to <code>$0</code>; <code>$0</code> represents
        <code>this</code>.</p>
    <p>If an array of <code>Object</code> is assigned to <code>$args</code>, then each element of that array is assigned
        to each parameter. If a parameter type is a primitive type, the type of the corresponding element must be a
        wrapper type. The value is converted from the wrapper type to the primitive type before it is assigned to the
        parameter.</p><h4><a name='header-n18659' class='md-header-anchor '></a>`#### </h4>
    <p>The variable <code>$$</code> is abbreviation of a list of all the parameters separated by commas. For example, if
        the number of the parameters to method <code>move()</code> is three, then</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18661"
         mdtype="fences">move($$)
</pre>
    <p>is equivalent to this:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18663"
         mdtype="fences">  move($1, $2, $3)
</pre>
    <p>If <code>move()</code> does not take any parameters, then <code>move($$)</code> is equivalent to
        <code>move()</code>.</p>
    <p><code>$$</code> can be used with another method. If you write an expression:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18666"
         mdtype="fences">  exMove($$, context)
</pre>
    <p>then this expression is equivalent to:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18668"
         mdtype="fences">  exMove($1, $2, $3, context)
</pre>
    <p>Note that <code>$$</code> enables generic notation of method call with respect to the number of parameters. It is
        typically used with <code>$proceed</code> shown later.</p><h4><a name='header-n18670'
                                                                         class='md-header-anchor '></a><code>$cflow</code>
    </h4>
    <p><code>$cflow</code> means &quot;control flow&quot;. This readonly variable returns the depth of the recursive
        calls to a specific method.</p>
    <p>Suppose that the method shown below is represented by a <code>CtMethod</code> object <code>cm</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18673"
         mdtype="fences">  int fact(int n) {
      if (n &lt;= 1)
          return n;
      else
          return n * fact(n  1);
  }
</pre>
    <p>To use <code>$cflow</code>, first declare that <code>$cflow</code> is used for monitoring calls to the method
        <code>fact()</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18675"
         mdtype="fences">  CtMethod cm = ...;
  cm.useCflow("fact");
</pre>
    <p>The parameter to <code>useCflow()</code> is the identifier of the declared <code>$cflow</code> variable. Any
        valid Java name can be used as the identifier. Since the identifier can also include <code>.</code> (dot), for
        example, <code>&quot;my.Test.fact&quot;</code> is a valid identifier.</p>
    <p>Then, <code>$cflow(fact)</code> represents the depth of the recursive calls to the method specified by
        <code>cm</code>. The value of <code>$cflow(fact)</code> is 0 (zero) when the method is first called whereas it
        is 1 when the method is recursively called within the method. For example,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18678"
         mdtype="fences">  cm.insertBefore("if ($cflow(fact) == 0)"
                + "    System.out.println(\"fact \" + $1);");
</pre>
    <p>translates the method <code>fact()</code> so that it shows the parameter. Since the value of
        <code>$cflow(fact)</code> is checked, the method <code>fact()</code> does not show the parameter if it is
        recursively called within <code>fact()</code>.</p>
    <p>The value of <code>$cflow</code> is the number of stack frames associated with the specified method
        <code>cm</code> under the current topmost stack frame for the current thread. <code>$cflow</code> is also
        accessible within a method different from the specified method <code>cm</code>.</p><h4><a name='header-n18681'
                                                                                                  class='md-header-anchor '></a><code>$r</code>
    </h4>
    <p><code>$r</code> represents the result type (return type) of the method. It must be used as the cast type in a
        cast expression. For example, this is a typical use:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18683"
         mdtype="fences">  Object result = ... ;
  $_ = ($r)result;
</pre>
    <p>If the result type is a primitive type, then <code>($r)</code> follows special semantics. First, if the operand
        type of the cast expression is a primitive type, <code>($r)</code> works as a normal cast operator to the result
        type. On the other hand, if the operand type is a wrapper type, <code>($r)</code> converts from the wrapper type
        to the result type. For example, if the result type is <code>int</code>, then <code>($r)</code> converts from
        <code>java.lang.Integer</code> to <code>int</code>.</p>
    <p>If the result type is <code>void</code>, then <code>($r)</code> does not convert a type; it does nothing.
        However, if the operand is a call to a <code>void</code> method, then <code>($r)</code> results in
        <code>null</code>. For example, if the result type is <code>void</code> and <code>foo()</code> is a
        <code>void</code> method, then</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18686"
         mdtype="fences">  $_ = ($r)foo();
</pre>
    <p>is a valid statement.</p>
    <p>The cast operator <code>($r)</code> is also useful in a <code>return</code> statement. Even if the result type is
        <code>void</code>, the following <code>return</code> statement is valid:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18689"
         mdtype="fences">  return ($r)result;
</pre>
    <p>Here, <code>result</code> is some local variable. Since <code>($r)</code> is specified, the resulting value is
        discarded. This <code>return</code> statement is regarded as the equivalent of the <code>return</code> statement
        without a resulting value:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18691"
         mdtype="fences">  return;
</pre>
    <h4><a name='header-n18692' class='md-header-anchor '></a><code>$w</code></h4>
    <p><code>$w</code> represents a wrapper type. It must be used as the cast type in a cast expression.
        <code>($w)</code> converts from a primitive type to the corresponding wrapper type. The following code is an
        example:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18694"
         mdtype="fences">  Integer i = ($w)5;
</pre>
    <p>The selected wrapper type depends on the type of the expression following <code>($w)</code>. If the type of the
        expression is <code>double</code>, then the wrapper type is <code>java.lang.Double</code>.</p>
    <p>If the type of the expression following <code>($w)</code> is not a primitive type, then <code>($w)</code> does
        nothing.</p><h4><a name='header-n18697' class='md-header-anchor '></a><code>$_</code></h4>
    <p><code>insertAfter()</code> in <code>CtMethod</code> and <code>CtConstructor</code> inserts the compiled code at
        the end of the method. In the statement given to <code>insertAfter()</code>, not only the variables shown above
        such as <code>$0</code>, <code>$1</code>, ... but also <code>$_</code> is available.</p>
    <p>The variable <code>$_</code> represents the resulting value of the method. The type of that variable is the type
        of the result type (the return type) of the method. If the result type is <code>void</code>, then the type of
        <code>$_</code> is <code>Object</code> and the value of <code>$_</code> is <code>null</code>.</p>
    <p>Although the compiled code inserted by <code>insertAfter()</code> is executed just before the control normally
        returns from the method, it can be also executed when an exception is thrown from the method. To execute it when
        an exception is thrown, the second parameter <code>asFinally</code> to <code>insertAfter()</code> must be <code>true</code>.
    </p>
    <p>If an exception is thrown, the compiled code inserted by <code>insertAfter()</code> is executed as a <code>finally</code>
        clause. The value of <code>$_</code> is <code>0</code> or <code>null</code> in the compiled code. After the
        execution of the compiled code terminates, the exception originally thrown is rethrown to the caller. Note that
        the value of <code>$_</code> is never thrown to the caller; it is rather discarded.</p><h4><a
            name='header-n18702' class='md-header-anchor '></a><code>$sig</code></h4>
    <p>The value of <code>$sig</code> is an array of <code>java.lang.Class</code> objects that represent the formal
        parameter types in declaration order.</p><h4><a name='header-n18704'
                                                        class='md-header-anchor '></a><code>$type</code></h4>
    <p>The value of <code>$type</code> is an <code>java.lang.Class</code> object representing the formal type of the
        result value. This variable refers to <code>Void.class</code> if this is a constructor.</p><h4><a
            name='header-n18706' class='md-header-anchor '></a><code>$class</code></h4>
    <p>The value of <code>$class</code> is an <code>java.lang.Class</code> object representing the class in which the
        edited method is declared. This represents the type of <code>$0</code>.</p><h4><a name='header-n18708'
                                                                                          class='md-header-anchor '></a><code>addCatch()</code>
    </h4>
    <p><code>addCatch()</code> inserts a code fragment into a method body so that the code fragment is executed when the
        method body throws an exception and the control returns to the caller. In the source text representing the
        inserted code fragment, the exception value is referred to with the special variable <code>$e</code>.</p>
    <p>For example, this program:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18711"
         mdtype="fences">  CtMethod m = ...;
  CtClass etype = ClassPool.getDefault().get("java.io.IOException");
  m.addCatch("{ System.out.println($e); throw $e; }", etype);
</pre>
    <p>translates the method body represented by <code>m</code> into something like this:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18713"
         mdtype="fences">  try {
      the original method body
  }
  catch (java.io.IOException e) {
      System.out.println(e);
      throw e;
  }
</pre>
    <p>Note that the inserted code fragment must end with a <code>throw</code> or <code>return</code> statement.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n18716' class='md-header-anchor '></a>4.2 Altering a method body</h3>
    <p><code>CtMethod</code> and <code>CtConstructor</code> provide <code>setBody()</code> for substituting a whole
        method body. They compile the given source text into Java bytecode and substitutes it for the original method
        body. If the given source text is <code>null</code>, the substituted body includes only a <code>return</code>
        statement, which returns zero or null unless the result type is <code>void</code>.</p>
    <p>In the source text given to <code>setBody()</code>, the identifiers starting with <code>$</code> have special
        meaning</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>标识符</th>
                <th>含义</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0, $1, $2, ...</code></td>
                <td>this and actual parameters</td>
            </tr>
            <tr>
                <td><code>$args</code></td>
                <td>An array of parameters. The type of $args is Object[].</td>
            </tr>
            <tr>
                <td><code>$$</code></td>
                <td>All actual parameters.</td>
            </tr>
            <tr>
                <td><code>$cflow(...)</code></td>
                <td>cflow variable</td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>The result type. It is used in a cast expression.</td>
            </tr>
            <tr>
                <td><code>$w</code></td>
                <td>The wrapper type. It is used in a cast expression.</td>
            </tr>
            <tr>
                <td><code>$sig</code></td>
                <td>An array of java.lang.Class objects representing the formal parameter types.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A java.lang.Class object representing the formal result type.</td>
            </tr>
            <tr>
                <td><code>$class</code></td>
                <td>A java.lang.Class object representing the class that declares the methodcurrently edited (the type
                    of $0).
                </td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>Note that <code>$_</code> is not available.</p><h4><a name='header-n18751' class='md-header-anchor '></a>Substituting
        source text for an existing expression</h4>
    <p>Javassist allows modifying only an expression included in a method body. <code>javassist.expr.ExprEditor</code>
        is a class for replacing an expression in a method body. The users can define a subclass of
        <code>ExprEditor</code> to specify how an expression is modified.</p>
    <p>To run an <code>ExprEditor</code> object, the users must call <code>instrument()</code> in <code>CtMethod</code>
        or <code>CtClass</code>. For example,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18754"
         mdtype="fences">  CtMethod cm = ... ;
  cm.instrument(
      new ExprEditor() {
          public void edit(MethodCall m)
                        throws CannotCompileException
          {
              if (m.getClassName().equals("Point")
                            &amp;&amp; m.getMethodName().equals("move"))
                  m.replace("{ $1 = 0; $_ = $proceed($$); }");
          }
      });
</pre>
    <p>searches the method body represented by <code>cm</code> and replaces all calls to <code>move()</code> in class
        <code>Point</code> with a block:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18756"
         mdtype="fences">  { $1 = 0; $_ = $proceed($$); }
</pre>
    <p>so that the first parameter to <code>move()</code> is always 0. Note that the substituted code is not an
        expression but a statement or a block. It cannot be or contain a trycatch statement.</p>
    <p>The method <code>instrument()</code> searches a method body. If it finds an expression such as a method call,
        field access, and object creation, then it calls <code>edit()</code> on the given <code>ExprEditor</code>
        object. The parameter to <code>edit()</code> is an object representing the found expression. The
        <code>edit()</code> method can inspect and replace the expression through that object.</p>
    <p>Calling <code>replace()</code> on the parameter to <code>edit()</code> substitutes the given statement or block
        for the expression. If the given block is an empty block, that is, if <code>replace(&quot;{}&quot;)</code> is
        executed, then the expression is removed from the method body. If you want to insert a statement (or a block)
        before/after the expression, a block like the following should be passed to <code>replace()</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18760"
         mdtype="fences">  { beforestatements;
    $_ = $proceed($$);
    afterstatements; }
</pre>
    <p>whichever the expression is either a method call, field access, object creation, or others. The second statement
        could be:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18762"
         mdtype="fences">  $_ = $proceed();
</pre>
    <p>if the expression is read access, or</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n18764"
         mdtype="fences">  $proceed($$);
</pre>
    <p>if the expression is write access.</p>
    <p>Local variables available in the target expression is also available in the source text passed to
        <code>replace()</code> if the method searched by <code>instrument()</code> was compiled with the g option (the
        class file includes a local variable attribute).</p><h4><a name='header-n18767' class='md-header-anchor '></a>javassist.expr.MethodCall
    </h4>
    <p>A <code>MethodCall</code> object represents a method call. The method <code>replace()</code> in
        <code>MethodCall</code> substitutes a statement or a block for the method call. It receives source text
        representing the substitued statement or block, in which the identifiers starting with <code>$</code> have
        special meaning as in the source text passed to <code>insertBefore()</code>.</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0</code></td>
                <td>The target object of the method call.This is not equivalent to this, which represents the
                    caller-side this object.$0 is null if the method is static.
                </td>
            </tr>
            <tr>
                <td><code>$1, $2, ...</code></td>
                <td>The parameters of the method call.</td>
            </tr>
            <tr>
                <td><code>$_</code></td>
                <td>The resulting value of the method call.</td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>The result type of the method call.</td>
            </tr>
            <tr>
                <td><code>$class</code></td>
                <td>A java.lang.Class object representing the class declaring the method.</td>
            </tr>
            <tr>
                <td><code>$sig</code></td>
                <td>An array of java.lang.Class objects representing the formal parameter types.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A java.lang.Class object representing the formal result type.</td>
            </tr>
            <tr>
                <td><code>$proceed</code></td>
                <td>The name of the method originally called in the expression.</td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>Here the method call means the one represented by the <code>MethodCall</code> object.</p>
    <p>The other identifiers such as <code>$w</code>, <code>$args</code> and <code>$$</code> are also available.</p>
    <p>Unless the result type of the method call is <code>void</code>, a value must be assigned to <code>$_</code> in
        the source text and the type of <code>$_</code> is the result type. If the result type is <code>void</code>, the
        type of <code>$_</code> is <code>Object</code> and the value assigned to <code>$_</code> is ignored.</p>
    <p><code>$proceed</code> is not a <code>String</code> value but special syntax. It must be followed by an argument
        list surrounded by parentheses <code>( )</code>.</p><h4><a name='header-n18801' class='md-header-anchor '></a>javassist.expr.ConstructorCall
    </h4>
    <p>A <code>ConstructorCall</code> object represents a constructor call such as <code>this()</code> and
        <code>super</code> included in a constructor body. The method <code>replace()</code> in
        <code>ConstructorCall</code> substitutes a statement or a block for the constructor call. It receives source
        text representing the substituted statement or block, in which the identifiers starting with <code>$</code> have
        special meaning as in the source text passed to <code>insertBefore()</code>.</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0</code></td>
                <td>The target object of the constructor call. This is equivalent to <code>this</code>.</td>
            </tr>
            <tr>
                <td><code>$1</code>, <code>$2</code>, ...</td>
                <td>The parameters of the constructor call.</td>
            </tr>
            <tr>
                <td><code>$class</code></td>
                <td>A <code>java.lang.Class</code> object representing the class declaring the constructor.</td>
            </tr>
            <tr>
                <td><code>$sig</code></td>
                <td>An array of <code>java.lang.Class</code> objects representing the formal parameter types.</td>
            </tr>
            <tr>
                <td><code>$proceed</code></td>
                <td>The name of the constructor originally called in the expression.</td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>Here the constructor call means the one represented by the <code>ConstructorCall</code> object.</p>
    <p>The other identifiers such as <code>$w</code>, <code>$args</code> and <code>$$</code> are also available.</p>
    <p>Since any constructor must call either a constructor of the super class or another constructor of the same class,
        the substituted statement must include a constructor call, normally a call to <code>$proceed()</code>.</p>
    <p><code>$proceed</code> is not a <code>String</code> value but special syntax. It must be followed by an argument
        list surrounded by parentheses <code>( )</code>.</p><h4><a name='header-n18826' class='md-header-anchor '></a>javassist.expr.FieldAccess
    </h4>
    <p>A <code>FieldAccess</code> object represents field access. The method <code>edit()</code> in
        <code>ExprEditor</code> receives this object if field access is found. The method <code>replace()</code> in
        <code>FieldAccess</code> receives source text representing the substitued statement or block for the field
        access.</p>
    <p>In the source text, the identifiers starting with <code>$</code> have special meaning:</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0</code></td>
                <td>The object containing the field accessed by the expression. This is not equivalent to this.this
                    represents the object that the method including the expression is invoked on.$0 is null if the field
                    is static.
                </td>
            </tr>
            <tr>
                <td><code>$1</code></td>
                <td>The value that would be stored in the field if the expression is write access.Otherwise, $1 is not
                    available.
                </td>
            </tr>
            <tr>
                <td><code>$_</code></td>
                <td>The resulting value of the field access if the expression is read access.Otherwise, the value stored
                    in $_ is discarded.
                </td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>The type of the field if the expression is read access.Otherwise, $r is void.</td>
            </tr>
            <tr>
                <td><code>$class</code></td>
                <td>A java.lang.Class object representing the class declaring the field.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A java.lang.Class object representing the field type.</td>
            </tr>
            <tr>
                <td><code>$proceed</code></td>
                <td>The name of a virtual method executing the original field access. .</td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>The other identifiers such as <code>$w</code>, <code>$args</code> and <code>$$</code> are also available.</p>
    <p>If the expression is read access, a value must be assigned to <code>$_</code> in the source text. The type of
        <code>$_</code> is the type of the field.</p><h4><a name='header-n18856' class='md-header-anchor '></a>javassist.expr.NewExpr
    </h4>
    <p>A <code>NewExpr</code> object represents object creation with the <code>new</code> operator (not including array
        creation). The method <code>edit()</code> in <code>ExprEditor</code> receives this object if object creation is
        found. The method <code>replace()</code> in <code>NewExpr</code> receives source text representing the
        substitued statement or block for the object creation.</p>
    <p>In the source text, the identifiers starting with <code>$</code> have special meaning:</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0</code></td>
                <td><code>null</code>.</td>
            </tr>
            <tr>
                <td><code>$1</code>, <code>$2</code>, ...</td>
                <td>The parameters to the constructor.</td>
            </tr>
            <tr>
                <td><code>$_</code></td>
                <td>The resulting value of the object creation. A newly created object must be stored in this
                    variable.
                </td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>The type of the created object.</td>
            </tr>
            <tr>
                <td><code>$sig</code></td>
                <td>An array of <code>java.lang.Class</code> objects representing the formal parameter types.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A <code>java.lang.Class</code> object representing the class of the created object.</td>
            </tr>
            <tr>
                <td><code>$proceed</code></td>
                <td>The name of a virtual method executing the original object creation. .</td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>The other identifiers such as <code>$w</code>, <code>$args</code> and <code>$$</code> are also available.</p><h4>
        <a name='header-n18885' class='md-header-anchor '></a>javassist.expr.NewArray</h4>
    <p>A <code>NewArray</code> object represents array creation with the <code>new</code> operator. The method <code>edit()</code>
        in <code>ExprEditor</code> receives this object if array creation is found. The method <code>replace()</code> in
        <code>NewArray</code> receives source text representing the substitued statement or block for the array
        creation.</p>
    <p>In the source text, the identifiers starting with <code>$</code> have special meaning:</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0</code></td>
                <td><code>null</code>.</td>
            </tr>
            <tr>
                <td><code>$1</code>, <code>$2</code>, ...</td>
                <td>The size of each dimension.</td>
            </tr>
            <tr>
                <td><code>$_</code></td>
                <td>The resulting value of the array creation. A newly created array must be stored in this variable.
                </td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>The type of the created array.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A <code>java.lang.Class</code> object representing the class of the created array.</td>
            </tr>
            <tr>
                <td><code>$proceed</code></td>
                <td>The name of a virtual method executing the original array creation. .</td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>The other identifiers such as <code>$w</code>, <code>$args</code> and <code>$$</code> are also available.</p>
    <p>For example, if the array creation is the following expression,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18912"
         mdtype="fences">  String[][] s = new String[3][4];
</pre>
    <p>then the value of <span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg
            xmlns:xlink="http://www.w3.org/1999/xlink" width="4.998ex" height="2.065ex" viewBox="0 -776.4 2152 889.1"
            role="img" focusable="false" style="vertical-align: -0.262ex;"><defs><path stroke-width="0"
                                                                                       id="E3-MJMAIN-31"
                                                                                       d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path
            stroke-width="0" id="E3-MJMATHI-61"
            d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path
            stroke-width="0" id="E3-MJMATHI-6E"
            d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path
            stroke-width="0" id="E3-MJMATHI-64"
            d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></defs><g
            stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use
            xlink:href="#E3-MJMAIN-31" x="0" y="0"></use><use xlink:href="#E3-MJMATHI-61" x="500" y="0"></use><use
            xlink:href="#E3-MJMATHI-6E" x="1029" y="0"></use><use xlink:href="#E3-MJMATHI-64" x="1629" y="0"></use></g></svg></span>
        <script type="math/tex">1 and </script>
        2 are 3 and 4, respectively. $3 is not available.
    </p>
    <p>If the array creation is the following expression,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18915"
         mdtype="fences">  String[][] s = new String[3][];
</pre>
    <p>then the value of <span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg
            xmlns:xlink="http://www.w3.org/1999/xlink" width="7.377ex" height="2.065ex" viewBox="0 -776.4 3176 889.1"
            role="img" focusable="false" style="vertical-align: -0.262ex;"><defs><path stroke-width="0"
                                                                                       id="E4-MJMAIN-31"
                                                                                       d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path
            stroke-width="0" id="E4-MJMATHI-69"
            d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path
            stroke-width="0" id="E4-MJMATHI-73"
            d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path
            stroke-width="0" id="E4-MJMAIN-33"
            d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path
            stroke-width="0" id="E4-MJMATHI-62"
            d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path><path
            stroke-width="0" id="E4-MJMATHI-75"
            d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path
            stroke-width="0" id="E4-MJMATHI-74"
            d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g
            stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use
            xlink:href="#E4-MJMAIN-31" x="0" y="0"></use><use xlink:href="#E4-MJMATHI-69" x="500" y="0"></use><use
            xlink:href="#E4-MJMATHI-73" x="845" y="0"></use><use xlink:href="#E4-MJMAIN-33" x="1314" y="0"></use><use
            xlink:href="#E4-MJMATHI-62" x="1814" y="0"></use><use xlink:href="#E4-MJMATHI-75" x="2243" y="0"></use><use
            xlink:href="#E4-MJMATHI-74" x="2815" y="0"></use></g></svg></span>
        <script type="math/tex">1 is 3 but </script>
        2 is not available.
    </p>
    <h4><a name='header-n18917' class='md-header-anchor '></a>javassist.expr.Instanceof</h4>
    <p>A <code>Instanceof</code> object represents an <code>instanceof</code> expression. The method <code>edit()</code>
        in <code>ExprEditor</code> receives this object if an instanceof expression is found. The method
        <code>replace()</code> in <code>Instanceof</code> receives source text representing the substitued statement or
        block for the expression.</p>
    <p>In the source text, the identifiers starting with <code>$</code> have special meaning:</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0</code></td>
                <td><code>null</code>.</td>
            </tr>
            <tr>
                <td><code>$1</code></td>
                <td>The value on the left hand side of the original <code>instanceof</code> operator.</td>
            </tr>
            <tr>
                <td><code>$_</code></td>
                <td>The resulting value of the expression. The type of <code>$_</code> is <code>boolean</code>.</td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>The type on the right hand side of the <code>instanceof</code> operator.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A <code>java.lang.Class</code> object representing the type on the right hand side of the <code>instanceof</code>
                    operator.
                </td>
            </tr>
            <tr>
                <td><code>$proceed</code></td>
                <td>The name of a virtual method executing the original <code>instanceof</code> expression. It takes one
                    parameter (the type is <code>java.lang.Object</code>) and returns true if the parameter value is an
                    instance of the type on the right hand side of the original <code>instanceof</code> operator.
                    Otherwise, it returns false.
                </td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>The other identifiers such as <code>$w</code>, <code>$args</code> and <code>$$</code> are also available.</p><h4>
        <a name='header-n18943' class='md-header-anchor '></a>javassist.expr.Cast</h4>
    <p>A <code>Cast</code> object represents an expression for explicit type casting. The method <code>edit()</code> in
        <code>ExprEditor</code> receives this object if explicit type casting is found. The method
        <code>replace()</code> in <code>Cast</code> receives source text representing the substitued statement or block
        for the expression.</p>
    <p>In the source text, the identifiers starting with <code>$</code> have special meaning:</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$0</code></td>
                <td><code>null</code>.</td>
            </tr>
            <tr>
                <td><code>$1</code></td>
                <td>The value the type of which is explicitly cast.</td>
            </tr>
            <tr>
                <td><code>$_</code></td>
                <td>The resulting value of the expression. The type of <code>$_</code> is the same as the type after the
                    explicit casting, that is, the type surrounded by <code>( )</code>.
                </td>
            </tr>
            <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>the type after the explicit casting, or the type surrounded by <code>( )</code>.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A <code>java.lang.Class</code> object representing the same type as <code>$r</code>.</td>
            </tr>
            <tr>
                <td><code>$proceed</code></td>
                <td>The name of a virtual method executing the original type casting. It takes one parameter of the type
                    <code>java.lang.Object</code> and returns it after the explicit type casting specified by the
                    original expression.
                </td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>The other identifiers such as <code>$w</code>, <code>$args</code> and <code>$$</code> are also available.</p><h4>
        <a name='header-n18972' class='md-header-anchor '></a>javassist.expr.Handler</h4>
    <p>A <code>Handler</code> object represents a <code>catch</code> clause of <code>trycatch</code> statement. The
        method <code>edit()</code> in <code>ExprEditor</code> receives this object if a <code>catch</code> is found. The
        method <code>insertBefore()</code> in <code>Handler</code> compiles the received source text and inserts it at
        the beginning of the <code>catch</code> clause.</p>
    <p>In the source text, the identifiers starting with <code>$</code> have meaning:</p>
    <figure>
        <table>
            <thead>
            <tr>
                <th>含义</th>
                <th>标识符</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><code>$1</code></td>
                <td>The exception object caught by the <code>catch</code> clause.</td>
            </tr>
            <tr>
                <td><code>$r</code></td>
                <td>the type of the exception caught by the <code>catch</code> clause. It is used in a cast expression.
                </td>
            </tr>
            <tr>
                <td><code>$w</code></td>
                <td>The wrapper type. It is used in a cast expression.</td>
            </tr>
            <tr>
                <td><code>$type</code></td>
                <td>A <code>java.lang.Class</code> object representing the type of the exception caught by the <code>catch</code>
                    clause.
                </td>
            </tr>
            <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            </tbody>
        </table>
    </figure>
    <p>If a new exception object is assigned to <code>$1</code>, it is passed to the original <code>catch</code> clause
        as the caught exception.</p>
    <h3><a name='header-n18995' class='md-header-anchor '></a>4.3 Adding a new method or field</h3><h4><a
            name='header-n18996' class='md-header-anchor '></a>Adding a method</h4>
    <p>Javassist allows the users to create a new method and constructor from scratch. <code>CtNewMethod</code> and
        <code>CtNewConstructor</code> provide several factory methods, which are static methods for creating <code>CtMethod</code>
        or <code>CtConstructor</code> objects. Especially, <code>make()</code> creates a <code>CtMethod</code> or <code>CtConstructor</code>
        object from the given source text.</p>
    <p>For example, this program:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n18999"
         mdtype="fences">  CtClass point = ClassPool.getDefault().get("Point");
  CtMethod m = CtNewMethod.make(
                   "public int xmove(int dx) { x += dx; }",
                   point);
  point.addMethod(m);
</pre>
    <p>adds a public method <code>xmove()</code> to class <code>Point</code>. In this example, <code>x</code> is a
        <code>int</code> field in the class <code>Point</code>.</p>
    <p>The source text passed to <code>make()</code> can include the identifiers starting with <code>$</code> except
        <code>$_</code> as in <code>setBody()</code>. It can also include <code>$proceed</code> if the target object and
        the target method name are also given to <code>make()</code>. For example,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19002"
         mdtype="fences">  CtClass point = ClassPool.getDefault().get("Point");
  CtMethod m = CtNewMethod.make(
                   "public int ymove(int dy) { $proceed(0, dy); }",
                   point, "this", "move");
</pre>
    <p>this program creates a method <code>ymove()</code> defined below:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19004"
         mdtype="fences">  public int ymove(int dy) { this.move(0, dy); }
</pre>
    <p>Note that <code>$proceed</code> has been replaced with <code>this.move</code>.</p>
    <p>Javassist provides another way to add a new method. You can first create an abstract method and later give it a
        method body:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19007"
         mdtype="fences">  CtClass cc = ... ;
  CtMethod m = new CtMethod(CtClass.intType, "move",
                            new CtClass[] { CtClass.intType }, cc);
  cc.addMethod(m);
  m.setBody("{ x += $1; }");
  cc.setModifiers(cc.getModifiers() &amp; ~Modifier.ABSTRACT);
</pre>
    <p>Since Javassist makes a class abstract if an abstract method is added to the class, you have to explicitly change
        the class back to a nonabstract one after calling <code>setBody()</code>.</p><h4><a name='header-n19009'
                                                                                            class='md-header-anchor '></a>Mutual
        recursive methods</h4>
    <p>Javassist cannot compile a method if it calls another method that has not been added to a class. (Javassist can
        compile a method that calls itself recursively.) To add mutual recursive methods to a class, you need a trick
        shown below. Suppose that you want to add methods <code>m()</code> and <code>n()</code> to a class represented
        by <code>cc</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19011"
         mdtype="fences">  CtClass cc = ... ;
  CtMethod m = CtNewMethod.make("public abstract int m(int i);", cc);
  CtMethod n = CtNewMethod.make("public abstract int n(int i);", cc);
  cc.addMethod(m);
  cc.addMethod(n);
  m.setBody("{ return ($1 &lt;= 0) ? 1 : (n($1  1) * $1); }");
  n.setBody("{ return m($1); }");
  cc.setModifiers(cc.getModifiers() &amp; ~Modifier.ABSTRACT);
</pre>
    <p>You must first make two abstract methods and add them to the class. Then you can give the method bodies to these
        methods even if the method bodies include method calls to each other. Finally you must change the class to a
        notabstract class since <code>addMethod()</code> automatically changes a class into an abstract one if an
        abstract method is added.</p><h4><a name='header-n19013' class='md-header-anchor '></a>Adding a field</h4>
    <p>Javassist also allows the users to create a new field.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19015"
         mdtype="fences">  CtClass point = ClassPool.getDefault().get("Point");
  CtField f = new CtField(CtClass.intType, "z", point);
  point.addField(f);
</pre>
    <p>This program adds a field named <code>z</code> to class <code>Point</code>.</p>
    <p>If the initial value of the added field must be specified, the program shown above must be modified into:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19018"
         mdtype="fences">  CtClass point = ClassPool.getDefault().get("Point");
  CtField f = new CtField(CtClass.intType, "z", point);
  point.addField(f, "0");    // initial value is 0.
</pre>
    <p>Now, the method <code>addField()</code> receives the second parameter, which is the source text representing an
        expression computing the initial value. This source text can be any Java expression if the result type of the
        expression matches the type of the field. Note that an expression does not end with a semi colon (<code>;</code>).
    </p>
    <p>Furthermore, the above code can be rewritten into the following simple code:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19021"
         mdtype="fences">  CtClass point = ClassPool.getDefault().get("Point");
  CtField f = CtField.make("public int z = 0;", point);
  point.addField(f);
</pre>
    <h4><a name='header-n19022' class='md-header-anchor '></a>Removing a member</h4>
    <p>To remove a field or a method, call <code>removeField()</code> or <code>removeMethod()</code> in
        <code>CtClass</code>. A <code>CtConstructor</code> can be removed by <code>removeConstructor()</code> in <code>CtClass</code>.
    </p>
    <h3><a name='header-n19024' class='md-header-anchor '></a>4.4 Annotations</h3>
    <p><code>CtClass</code>, <code>CtMethod</code>, <code>CtField</code> and <code>CtConstructor</code> provides a
        convenient method <code>getAnnotations()</code> for reading annotations. It returns an annotationtype object.
    </p>
    <p>For example, suppose the following annotation:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19027"
         mdtype="fences">  public @interface Author {
      String name();
      int year();
  }
</pre>
    <p>This annotation is used as the following:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19029"
         mdtype="fences">  @Author(name="Chiba", year=2005)
  public class Point {
      int x, y;
  }
</pre>
    <p>Then, the value of the annotation can be obtained by <code>getAnnotations()</code>. It returns an array
        containing annotationtype objects.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19031"
         mdtype="fences">  CtClass cc = ClassPool.getDefault().get("Point");
  Object[] all = cc.getAnnotations();
  Author a = (Author)all[0];
  String name = a.name();
  int year = a.year();
  System.out.println("name: " + name + ", year: " + year);
</pre>
    <p>This code snippet should print:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19033"
         mdtype="fences">  name: Chiba, year: 2005
</pre>
    <p>Since the annoation of <code>Point</code> is only <code>@Author</code>, the length of the array <code>all</code>
        is one and <code>all[0]</code> is an <code>Author</code> object. The member values of the annotation can be
        obtained by calling <code>name()</code> and <code>year()</code> on the <code>Author</code> object.</p>
    <p>To use <code>getAnnotations()</code>, annotation types such as <code>Author</code> must be included in the
        current class path. <em>They must be also accessible from a ClassPool object.</em> If the class file of an
        annotation type is not found, Javassist cannot obtain the default values of the members of that annotation type.
    </p>
    <h3><a name='header-n19036' class='md-header-anchor '></a>4.5 Runtime support classes</h3>
    <p>In most cases, a class modified by Javassist does not require Javassist to run. However, some kinds of bytecode
        generated by the Javassist compiler need runtime support classes, which are in the
        <code>javassist.runtime</code> package (for details, please read the API reference of that package). Note that
        the <code>javassist.runtime</code> package is the only package that classes modified by Javassist may need for
        running. The other Javassist classes are never used at runtime of the modified classes.</p>
    <h3><a name='header-n19038' class='md-header-anchor '></a>4.6 Import</h3>
    <p>All the class names in source code must be fully qualified (they must include package names). However, the <code>java.lang</code>
        package is an exception; for example, the Javassist compiler can resolve <code>Object</code> as well as <code>java.lang.Object</code>.
    </p>
    <p>To tell the compiler to search other packages when resolving a class name, call <code>importPackage()</code> in
        <code>ClassPool</code>. For example,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19041"
         mdtype="fences">  ClassPool pool = ClassPool.getDefault();
  pool.importPackage("java.awt");
  CtClass cc = pool.makeClass("Test");
  CtField f = CtField.make("public Point p;", cc);
  cc.addField(f);
</pre>
    <p>The seconde line instructs the compiler to import the <code>java.awt</code> package. Thus, the third line will
        not throw an exception. The compiler can recognize <code>Point</code> as <code>java.awt.Point</code>.</p>
    <p>Note that <code>importPackage()</code> <em>does not</em> affect the <code>get()</code> method in
        <code>ClassPool</code>. Only the compiler considers the imported packages. The parameter to <code>get()</code>
        must be always a fully qualified name.</p>
    <h3><a name='header-n19044' class='md-header-anchor '></a>4.7 Limitations</h3>
    <p>In the current implementation, the Java compiler included in Javassist has several limitations with respect to
        the language that the compiler can accept. Those limitations are:</p>
    <ul>
        <li>The new syntax introduced by J2SE 5.0 (including enums and generics) has not been supported. Annotations are
            supported by the low level API of Javassist. See the <code>javassist.bytecode.annotation</code> package (and
            also <code>getAnnotations()</code> in <code>CtClass</code> and <code>CtBehavior</code>). Generics are also
            only partly supported. See <a href='http://www.javassist.org/tutorial/tutorial3.html#generics'>the latter
                section</a> for more details.
        </li>
        <li>Array initializers, a comma-separated list of expressions enclosed by braces <code>{</code> and
            <code>}</code>, are not available unless the array dimension is one.
        </li>
        <li>Inner classes or anonymous classes are not supported. Note that this is a limitation of the compiler only.
            It cannot compile source code including an anonymous-class declaration. Javassist can read and modify a
            class file of inner/anonymous class.
        </li>
        <li>Labeled <code>continue</code> and <code>break</code> statements are not supported.</li>
        <li>The compiler does not correctly implement the Java method dispatch algorithm. The compiler may confuse if
            methods defined in a class have the same name but take different parameter lists.
        </li>
    </ul>
    <p>For example,</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19058"
         mdtype="fences">  class A {}
  class B extends A {}
  class C extends B {}

  class X {
      void foo(A a) { .. }
      void foo(B b) { .. }
  }
</pre>
    <p>If the compiled expression is <code>x.foo(new C())</code>, where <code>x</code> is an instance of X, the compiler
        may produce a call to <code>foo(A)</code> although the compiler can correctly compile <code>foo((B)new
            C())</code>.</p>
    <ul>
        <li><p>The users are recommended to use <code>#</code> as the separator between a class name and a static method
            or field name. For example, in regular Java,</p></li>
        <li><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19064"
                 mdtype="fences">javassist.CtClass.intType.getName()
</pre>
        </li>
    </ul>
    <p>calls a method <code>getName()</code> on the object indicated by the static field <code>intType</code> in <code>javassist.CtClass</code>.
        In Javassist, the users can write the expression shown above but they are recommended to write:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19066"
         mdtype="fences"> javassist.CtClass#intType.getName()
</pre>
    <p>so that the compiler can quickly parse the expression.</p>
    <h2><a name='header-n19068' class='md-header-anchor '></a>5. Bytecode level API</h2>
    <p>Javassist also provides lowerlevel API for directly editing a class file. To use this level of API, you need
        detailed knowledge of the Java bytecode and the class file format while this level of API allows you any kind of
        modification of class files.</p>
    <p>If you want to just produce a simple class file, <code>javassist.bytecode.ClassFileWriter</code> might provide
        the best API for you. It is much faster than <code>javassist.bytecode.ClassFile</code> although its API is
        minimum.</p>
    <h3><a name='header-n19071' class='md-header-anchor '></a>5.1 Obtaining a <code>ClassFile</code> object</h3>
    <p>A <code>javassist.bytecode.ClassFile</code> object represents a class file. To obtian this object, <code>getClassFile()</code>
        in <code>CtClass</code> should be called.</p>
    <p>Otherwise, you can construct a <code>javassist.bytecode.ClassFile</code> directly from a class file. For example,
    </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n19074"
         mdtype="fences">  BufferedInputStream fin
      = new BufferedInputStream(new FileInputStream("Point.class"));
  ClassFile cf = new ClassFile(new DataInputStream(fin));
</pre>
    <p>This code snippet creats a <code>ClassFile</code> object from <code>Point.class</code>.</p>
    <p>A <code>ClassFile</code> object can be written back to a class file. <code>write()</code> in
        <code>ClassFile</code> writes the contents of the class file to a given <code>DataOutputStream</code>.</p>
    <p>You can create a new class file from scratch. For example,</p>
    <blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false"
                     cid="n19079" mdtype="fences">ClassFile cf = new ClassFile(false, "test.Foo", null);
cf.setInterfaces(new String[] { "java.lang.Cloneable" });

FieldInfo f = new FieldInfo(cf.getConstPool(), "width", "I");
f.setAccessFlags(AccessFlag.PUBLIC);
cf.addField(f);

cf.write(new DataOutputStream(new FileOutputStream("Foo.class")));
</pre>
    </blockquote>
    <p>this code generates a class file <code>Foo.class</code> that contains the implementation of the following class:
    </p>
    <blockquote>
        <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
                class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
                style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
                autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
                style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
                class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                     cm-not-content="true"></div><div
                class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                             style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
                style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
                role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
                class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
                class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline"
                                                                 style="position: relative;"><div
                class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
                class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">package test;</span></pre></div><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">class Foo implements Cloneable {</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> public int width;</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                    style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div
                style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div
                class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre>
    </blockquote>
    <p>&nbsp;</p>
    <h3><a name='header-n19084' class='md-header-anchor '></a>5.2 Adding and removing a member</h3>
    <p><code>ClassFile</code> provides <code>addField()</code> and <code>addMethod()</code> for adding a field or a
        method (note that a constructor is regarded as a method at the bytecode level). It also provides <code>addAttribute()</code>
        for adding an attribute to the class file.</p>
    <p>Note that <code>FieldInfo</code>, <code>MethodInfo</code>, and <code>AttributeInfo</code> objects include a link
        to a <code>ConstPool</code> (constant pool table) object. The <code>ConstPool</code> object must be common to
        the <code>ClassFile</code> object and a <code>FieldInfo</code> (or <code>MethodInfo</code> etc.) object that is
        added to that <code>ClassFile</code> object. In other words, a <code>FieldInfo</code> (or
        <code>MethodInfo</code> etc.) object must not be shared among different <code>ClassFile</code> objects.</p>
    <p>To remove a field or a method from a <code>ClassFile</code> object, you must first obtain a
        <code>java.util.List</code> object containing all the fields of the class. <code>getFields()</code> and <code>getMethods()</code>
        return the lists. A field or a method can be removed by calling <code>remove()</code> on the <code>List</code>
        object. An attribute can be removed in a similar way. Call <code>getAttributes()</code> in
        <code>FieldInfo</code> or <code>MethodInfo</code> to obtain the list of attributes, and remove one from the
        list.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n19089' class='md-header-anchor '></a>5.3 Traversing a method body</h3>
    <p>To examine every bytecode instruction in a method body, <code>CodeIterator</code> is useful. To otbain this
        object, do as follows:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ClassFile cf = ... ;</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  MethodInfo minfo = cf.getMethod("move"); &nbsp;  // we assume move is not overloaded.</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CodeAttribute ca = minfo.getCodeAttribute();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CodeIterator i = ca.iterator();</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre>
    <p>A <code>CodeIterator</code> object allows you to visit every bytecode instruction one by one from the beginning
        to the end. The following methods are part of the methods declared in <code>CodeIterator</code>:</p>
    <p><code>void begin()</code>
        Move to the first instruction.
        <code>void move(int index)</code>
        Move to the instruction specified by the given index.
        <code>boolean hasNext()</code>
        Returns true if there is more instructions.
        <code>int next()</code>
        Returns the index of the next instruction.
        <em>Note that it does not return the opcode of the next instruction.</em>
        <code>int byteAt(int index)</code>
        Returns the unsigned 8bit value at the index.
        <code>int u16bitAt(int index)</code>
        Returns the unsigned 16bit value at the index.
        <code>int write(byte[] code, int index)</code>
        Writes a byte array at the index.
        <code>void insert(int index, byte[] code)</code>
        Inserts a byte array at the index. Branch offsets etc. are automatically adjusted.</p>
    <p>The following code snippet displays all the instructions included in a method body:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CodeIterator ci = ... ;</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  while (ci.hasNext()) {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  int index = ci.next();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  int op = ci.byteAt(index);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  System.out.println(Mnemonic.OPCODE[op]);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre>
    <p>&nbsp;</p>
    <h3><a name='header-n19097' class='md-header-anchor '></a>5.4 Producing a bytecode sequence</h3>
    <p>A <code>Bytecode</code> object represents a sequence of bytecode instructions. It is a growable array of
        bytecode. Here is a sample code snippet:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ConstPool cp = ...; &nbsp;  // constant pool table</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Bytecode b = new Bytecode(cp, 1, 0);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  b.addIconst(3);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  b.addReturn(CtClass.intType);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CodeAttribute ca = b.toCodeAttribute();</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre>
    <p>This produces the code attribute representing the following sequence:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  iconst_3</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ireturn</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre>
    <p>You can also obtain a byte array containing this sequence by calling <code>get()</code> in <code>Bytecode</code>.
        The obtained array can be inserted in another code attribute.</p>
    <p>While <code>Bytecode</code> provides a number of methods for adding a specific instruction to the sequence, it
        provides <code>addOpcode()</code> for adding an 8bit opcode and <code>addIndex()</code> for adding an index. The
        8bit value of each opcode is defined in the <code>Opcode</code> interface.</p>
    <p><code>addOpcode()</code> and other methods for adding a specific instruction are automatically maintain the
        maximum stack depth unless the control flow does not include a branch. This value can be obtained by calling
        <code>getMaxStack()</code> on the <code>Bytecode</code> object. It is also reflected on the
        <code>CodeAttribute</code> object constructed from the <code>Bytecode</code> object. To recompute the maximum
        stack depth of a method body, call <code>computeMaxStack()</code> in <code>CodeAttribute</code>.</p>
    <p><code>Bytecode</code> can be used to construct a method. For example,</p>
    <blockquote>
        <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
                class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
                style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
                autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
                style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
                class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                     cm-not-content="true"></div><div
                class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                             style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
                style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
                role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
                class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
                class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                          style="position: relative;"><div
                class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
                class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ClassFile cf = ...</span></pre></div><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Bytecode code = new Bytecode(cf.getConstPool());</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">code.addAload(0);</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">code.addInvokespecial("java/lang/Object", MethodInfo.nameInit, "()V");</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">code.addReturn(null);</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">code.setMaxLocals(1);</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                    style="padding-right: 0.1px;"><span
                cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span
                role="presentation" style="padding-right: 0.1px;">MethodInfo minfo = new MethodInfo(cf.getConstPool(), MethodInfo.nameInit, "()V");</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">minfo.setCodeAttribute(code.toCodeAttribute());</span></pre><pre
                class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cf.addMethod(minfo);</span></pre></div></div></div></div></div><div
                style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 220px;"></div><div
                class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre>
    </blockquote>
    <p>this code makes the default constructor and adds it to the class specified by <code>cf</code>. The
        <code>Bytecode</code> object is first converted into a <code>CodeAttribute</code> object and then added to the
        method specified by <code>minfo</code>. The method is finally added to a class file <code>cf</code>.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n19110' class='md-header-anchor '></a>5.5 Annotations (Meta tags)</h3>
    <p>Annotations are stored in a class file as runtime invisible (or visible) annotations attribute. These attributes
        can be obtained from <code>ClassFile</code>, <code>MethodInfo</code>, or <code>FieldInfo</code> objects. Call
        <code>getAttribute(AnnotationsAttribute.invisibleTag)</code> on those objects. For more details, see the javadoc
        manual of <code>javassist.bytecode.AnnotationsAttribute</code> class and the
        <code>javassist.bytecode.annotation</code> package.</p>
    <p>Javassist also let you access annotations by the higherlevel API. If you want to access annotations through
        <code>CtClass</code>, call <code>getAnnotations()</code> in <code>CtClass</code> or <code>CtBehavior</code>.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n19114' class='md-header-anchor '></a>6. Generics</h2>
    <p>The lowerlevel API of Javassist fully supports generics introduced by Java 5. On the other hand, the higherlevel
        API such as <code>CtClass</code> does not directly support generics. However, this is not a serious problem for
        bytecode transformation.</p>
    <p>The generics of Java is implemented by the erasure technique. After compilation, all type parameters are dropped
        off. For example, suppose that your source code declares a parameterized type <code>Vector&lt;String&gt;</code>:
    </p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Vector&lt;String&gt; v = new Vector&lt;String&gt;();</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  :</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  String s = v.get(0);</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre>
    <p>The compiled bytecode is equivalent to the following code:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Vector v = new Vector();</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  :</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  String s = (String)v.get(0);</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre>
    <p>So when you write a bytecode transformer, you can just drop off all type parameters. Because the compiler
        embedded in Javassist does not support generics, you must insert an explicit type cast at the caller site if the
        source code is compiled by Javassist, for example, through <code>CtMethod.make()</code>. No type cast is
        necessary if the source code is compiled by a normal Java compiler such as <code>javac</code>.</p>
    <p>For example, if you have a class:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  public class Wrapper&lt;T&gt; {</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  T value;</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  public Wrapper(T t) { value = t; }</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre>
    <p>and want to add an interface <code>Getter&lt;T&gt;</code> to the class <code>Wrapper&lt;T&gt;</code>:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  public interface Getter&lt;T&gt; {</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  T get();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre>
    <p>then the interface you really have to add is <code>Getter</code> (the type parameters <code>&lt;T&gt;</code>
        drops off) and the method you also have to add to the <code>Wrapper</code> class is this simple one:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  public Object get() { return value; }</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>Note that no type parameters are necessary. Since <code>get</code> returns an <code>Object</code>, an explicit
        type cast is needed at the caller site if the source code is compiled by Javassist. For example, if the type
        parameter <code>T</code> is <code>String</code>, then <code>(String)</code> must be inserted as follows:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Wrapper w = ...</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  String s = (String)w.get();</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre>
    <p>The type cast is not needed if the source code is compiled by a normal Java compiler because it will
        automatically insert a type cast.</p>
    <p>If you need to make type parameters accessible through reflection during runtime, you have to add generic
        signatures to the class file. For more details, see the API documentation (javadoc) of the <code>setGenericSignature</code>
        method in the <code>CtClass</code>.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n19132' class='md-header-anchor '></a>7. Varargs</h2>
    <p>Currently, Javassist does not directly support varargs. So to make a method with varargs, you must explicitly set
        a method modifier. But this is easy. Suppose that now you want to make the following method:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  public int length(int... args) { return args.length; }</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>The following code using Javassist will make the method shown above:</p>
    <p> CtClass cc = /* target class */; CtMethod m = CtMethod.make(&quot;public int length(int[] args) { return
        args.length; }&quot;, cc); m.setModifiers(m.getModifiers() | Modifier.VARARGS); cc.addMethod(m); </p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>The parameter type <code>int...</code> is changed into <code>int[]</code> and <code>Modifier.VARARGS</code> is
        added to the method modifiers.</p>
    <p>To call this method in the source code compiled by the compiler embedded in Javassist, you must write:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  length(new int[] { 1, 2, 3 });</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>instead of this method call using the varargs mechanism:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  length(1, 2, 3);</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>&nbsp;</p>
    <h2><a name='header-n19144' class='md-header-anchor '></a>8. J2ME</h2>
    <p>If you modify a class file for the J2ME execution environment, you must perform preverification. Preverifying is
        basically producing stack maps, which is similar to stack map tables introduced into J2SE at JDK 1.6. Javassist
        maintains the stack maps for J2ME only if <code>javassist.bytecode.MethodInfo.doPreverify</code> is true.</p>
    <p>You can also manually produce a stack map for a modified method. For a given method represented by a <code>CtMethod</code>
        object <code>m</code>, you can produce a stack map by calling the following methods:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  m.getMethodInfo().rebuildStackMapForME(cpool);</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>Here, <code>cpool</code> is a <code>ClassPool</code> object, which is available by calling
        <code>getClassPool()</code> on a <code>CtClass</code> object. A <code>ClassPool</code> object is responsible for
        finding class files from given class pathes. To obtain all the <code>CtMethod</code> objects, call the <code>getDeclaredMethods</code>
        method on a <code>CtClass</code> object.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n19150' class='md-header-anchor '></a>9. Boxing/Unboxing</h2>
    <p>Boxing and unboxing in Java are syntactic sugar. There is no bytecode for boxing or unboxing. So the compiler of
        Javassist does not support them. For example, the following statement is valid in Java:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap CodeMirror-focused" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Integer i = 3;</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>since boxing is implicitly performed. For Javassist, however, you must explicitly convert a value type from
        <code>int</code> to <code>Integer</code>:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Integer i = new Integer(3);</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>&nbsp;</p>
    <h2><a name='header-n19156' class='md-header-anchor '></a>10. Debug</h2>
    <p>Set <code>CtClass.debugDump</code> to a directory name. Then all class files modified and generated by Javassist
        are saved in that directory. To stop this, set <code>CtClass.debugDump</code> to null. The default value is
        null.</p>
    <p>For example,</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CtClass.debugDump = "./dump";</span></pre></div></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre>
    <p>All modified class files are saved in <code>./dump</code>.</p></div>
</body>
</html>